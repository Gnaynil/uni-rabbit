{"version":3,"file":"address-form.js","sources":["../../../../../src/pagesMember/address-form/address-form.vue","../../../../../uniPage:/cGFnZXNNZW1iZXJcYWRkcmVzcy1mb3JtXGFkZHJlc3MtZm9ybS52dWU"],"sourcesContent":["<script setup>\nimport { ref } from 'vue'\nimport {\n  postMemberAddressAPI,\n  getMemberAddressByIdAPI,\n  putMemberAddressByIdAPI,\n} from '@/services/address.js'\nimport { onLoad } from '@dcloudio/uni-app'\nconst query = defineProps({\n  id: {\n    type: String,\n    default: '',\n  },\n})\n\nuni.setNavigationBarTitle({\n  title: query.id ? '修改地址' : '新建地址',\n})\n// 表单数据\nconst form = ref({\n  receiver: '', // 收货人\n  contact: '', // 联系方式\n  fullLocation: '', // 省市区(前端展示)\n  provinceCode: '', // 省份编码(后端参数)\n  cityCode: '', // 城市编码(后端参数)\n  countyCode: '', // 区/县编码(后端参数)\n  address: '', // 详细地址\n  isDefault: 0, // 默认地址，1为是，0为否\n})\n//定义校验规则\nconst rules = {\n  receiver: {\n    rules: [{ required: true, errorMessage: '请输入收货人姓名' }],\n  },\n  contact: {\n    rules: [\n      { required: true, errorMessage: '请输入联系方式' },\n      { pattern: /^1[3-9]\\d{9}$/, errorMessage: '手机号格式不正确' },\n    ],\n  },\n  fullLocation: {\n    rules: [{ required: true, errorMessage: '请选择所在地区' }],\n  },\n  address: {\n    rules: [{ required: true, errorMessage: '请输入详细地址' }],\n  },\n}\n//表单组件实例\nconst formRef = ref()\n// #ifdef MP-WEIXIN\nconst onFullLocationChange = (e) => {\n  form.value.provinceCode = e.detail.code[0]\n  form.value.cityCode = e.detail.code[1]\n  form.value.countyCode = e.detail.code[2]\n  form.value.fullLocation = e.detail.value.join(' ')\n}\n// #endif\n\n// #ifdef H5\nconst onCitychange = (e) => {\n  const code = e.detail.value.map((v) => v.value)\n  const [provinceCode, cityCode, countyCode] = code\n  Object.assign(form.value, { provinceCode, cityCode, countyCode })\n  form.value.fullLocation = e.detail.value.map((v) => v.text).join(' ')\n  console.log(form.value)\n}\n// #endif\n\nconst onSwitchChange = (e) => {\n  if (e.detail.value) {\n    form.value.isDefault = 1\n  } else {\n    form.value.isDefault = 0\n  }\n  //保存地址\n}\nconst SaveAddress = async () => {\n  try {\n    await formRef.value.validate()\n    //修改地址\n    if (query.id) {\n      await putMemberAddressByIdAPI(query.id, form.value)\n      uni.showToast({\n        title: '修改成功',\n      })\n      setTimeout(() => {\n        uni.navigateBack()\n      }, 500)\n    }\n    //添加地址\n    else {\n      await postMemberAddressAPI(form.value)\n      uni.showToast({\n        title: '添加成功',\n      })\n      setTimeout(() => {\n        uni.navigateBack()\n      }, 500)\n    }\n  } catch (e) {\n    uni.showToast({\n      icon: 'error',\n      title: '请填写完整信息',\n    })\n  }\n}\n\n//修改地址获取数据\nconst getAddress = async () => {\n  const res = await getMemberAddressByIdAPI(query.id)\n  form.value = res.result\n}\nonLoad(() => getAddress())\n</script>\n\n<template>\n  <view class=\"content\">\n    <uni-forms :rules=\"rules\" :model=\"form\" ref=\"formRef\">\n      <!-- 表单内容 -->\n      <uni-forms-item name=\"receiver\" class=\"form-item\">\n        <text class=\"label\">收货人</text>\n        <input class=\"input\" placeholder=\"请填写收货人姓名\" v-model=\"form.receiver\" />\n      </uni-forms-item>\n      <uni-forms-item name=\"contact\" class=\"form-item\">\n        <text class=\"label\">手机号码</text>\n        <input class=\"input\" placeholder=\"请填写收货人手机号码\" v-model=\"form.contact\" />\n      </uni-forms-item>\n      <uni-forms-item name=\"fullLocation\" class=\"form-item\">\n        <text class=\"label\">所在地区</text>\n        <!-- #ifdef MP-WEIXIN -->\n        <picker\n          class=\"picker\"\n          mode=\"region\"\n          :value=\"form.fullLocation?.split(' ')\"\n          @change=\"onFullLocationChange\"\n        >\n          <view v-if=\"form.fullLocation\">{{ form.fullLocation }}</view>\n          <view v-else class=\"placeholder\">请选择省/市/区(县)</view>\n        </picker>\n        <!-- #endif-->\n        <!-- #ifdef H5 -->\n        <uni-data-picker\n          placeholder=\"请选择地址\"\n          popup-title=\"请选择城市\"\n          collection=\"opendb-city-china\"\n          field=\"code as value, name as text\"\n          orderby=\"value asc\"\n          :step-searh=\"true\"\n          self-field=\"code\"\n          parent-field=\"parent_code\"\n          :clear-icon=\"false\"\n          @change=\"onCitychange\"\n          v-model=\"form.countyCode\"\n        >\n        </uni-data-picker>\n        <!-- #endif -->\n      </uni-forms-item>\n      <uni-forms-item class=\"form-item\" name=\"address\">\n        <text class=\"label\">详细地址</text>\n        <input class=\"input\" placeholder=\"街道、楼牌号等信息\" v-model=\"form.address\" />\n      </uni-forms-item>\n      <view class=\"form-item\">\n        <label class=\"label\">设为默认地址</label>\n        <switch\n          @change=\"onSwitchChange\"\n          class=\"switch\"\n          color=\"#27ba9b\"\n          :checked=\"form.isDefault === 1\"\n        />\n      </view>\n    </uni-forms>\n  </view>\n  <!-- 提交按钮 -->\n  <button class=\"button\" @tap=\"SaveAddress\">保存并使用</button>\n</template>\n\n<style lang=\"scss\">\n/* #ifdef H5 */\n:deep(.selected-area) {\n  height: auto;\n  flex: 0 1 auto;\n}\n/* #endif */\n\npage {\n  background-color: #f4f4f4;\n}\n\n.content {\n  margin: 20rpx 20rpx 0;\n  padding: 0 20rpx;\n  border-radius: 10rpx;\n  background-color: #fff;\n\n  .form-item,\n  .uni-forms-item {\n    display: flex;\n    align-items: center;\n    min-height: 96rpx;\n    padding: 25rpx 10rpx 40rpx;\n    background-color: #fff;\n    font-size: 28rpx;\n    border-bottom: 1rpx solid #ddd;\n    position: relative;\n    margin-bottom: 0;\n\n    // 调整 uni-forms 样式\n    .uni-forms-item__content {\n      display: flex;\n    }\n\n    .uni-forms-item__error {\n      margin-left: 200rpx;\n    }\n\n    &:last-child {\n      border: none;\n    }\n\n    .label {\n      width: 200rpx;\n      color: #333;\n    }\n\n    .input {\n      flex: 1;\n      display: block;\n      height: 46rpx;\n    }\n\n    .switch {\n      position: absolute;\n      right: -20rpx;\n      transform: scale(0.8);\n    }\n\n    .picker {\n      flex: 1;\n    }\n\n    .placeholder {\n      color: #808080;\n    }\n  }\n}\n\n.button {\n  height: 80rpx;\n  margin: 30rpx 20rpx;\n  color: #fff;\n  border-radius: 80rpx;\n  font-size: 30rpx;\n  background-color: #27ba9b;\n}\n</style>\n","import MiniProgramPage from 'D:/code/uni-rabbit/src/pagesMember/address-form/address-form.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","ref","putMemberAddressByIdAPI","postMemberAddressAPI","getMemberAddressByIdAPI","onLoad"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAeAA,kBAAG,MAAC,sBAAsB;AAAA,MACxB,OAAO,MAAM,KAAK,SAAS;AAAA,IAC7B,CAAC;AAED,UAAM,OAAOC,cAAAA,IAAI;AAAA,MACf,UAAU;AAAA;AAAA,MACV,SAAS;AAAA;AAAA,MACT,cAAc;AAAA;AAAA,MACd,cAAc;AAAA;AAAA,MACd,UAAU;AAAA;AAAA,MACV,YAAY;AAAA;AAAA,MACZ,SAAS;AAAA;AAAA,MACT,WAAW;AAAA;AAAA,IACb,CAAC;AAED,UAAM,QAAQ;AAAA,MACZ,UAAU;AAAA,QACR,OAAO,CAAC,EAAE,UAAU,MAAM,cAAc,WAAU,CAAE;AAAA,MACrD;AAAA,MACD,SAAS;AAAA,QACP,OAAO;AAAA,UACL,EAAE,UAAU,MAAM,cAAc,UAAW;AAAA,UAC3C,EAAE,SAAS,iBAAiB,cAAc,WAAY;AAAA,QACvD;AAAA,MACF;AAAA,MACD,cAAc;AAAA,QACZ,OAAO,CAAC,EAAE,UAAU,MAAM,cAAc,UAAS,CAAE;AAAA,MACpD;AAAA,MACD,SAAS;AAAA,QACP,OAAO,CAAC,EAAE,UAAU,MAAM,cAAc,UAAS,CAAE;AAAA,MACpD;AAAA,IACH;AAEA,UAAM,UAAUA,cAAAA,IAAK;AAErB,UAAM,uBAAuB,CAAC,MAAM;AAClC,WAAK,MAAM,eAAe,EAAE,OAAO,KAAK,CAAC;AACzC,WAAK,MAAM,WAAW,EAAE,OAAO,KAAK,CAAC;AACrC,WAAK,MAAM,aAAa,EAAE,OAAO,KAAK,CAAC;AACvC,WAAK,MAAM,eAAe,EAAE,OAAO,MAAM,KAAK,GAAG;AAAA,IACnD;AAaA,UAAM,iBAAiB,CAAC,MAAM;AAC5B,UAAI,EAAE,OAAO,OAAO;AAClB,aAAK,MAAM,YAAY;AAAA,MAC3B,OAAS;AACL,aAAK,MAAM,YAAY;AAAA,MACxB;AAAA,IAEH;AACA,UAAM,cAAc,YAAY;AAC9B,UAAI;AACF,cAAM,QAAQ,MAAM,SAAU;AAE9B,YAAI,MAAM,IAAI;AACZ,gBAAMC,iBAAuB,wBAAC,MAAM,IAAI,KAAK,KAAK;AAClDF,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,UACf,CAAO;AACD,qBAAW,MAAM;AACfA,0BAAAA,MAAI,aAAc;AAAA,UACnB,GAAE,GAAG;AAAA,QACP,OAEI;AACH,gBAAMG,iBAAoB,qBAAC,KAAK,KAAK;AACrCH,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,UACf,CAAO;AACD,qBAAW,MAAM;AACfA,0BAAAA,MAAI,aAAc;AAAA,UACnB,GAAE,GAAG;AAAA,QACP;AAAA,MACF,SAAQ,GAAG;AACVA,sBAAAA,MAAI,UAAU;AAAA,UACZ,MAAM;AAAA,UACN,OAAO;AAAA,QACb,CAAK;AAAA,MACF;AAAA,IACH;AAGA,UAAM,aAAa,YAAY;AAC7B,YAAM,MAAM,MAAMI,yCAAwB,MAAM,EAAE;AAClD,WAAK,QAAQ,IAAI;AAAA,IACnB;AACAC,kBAAAA,OAAO,MAAM,WAAU,CAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/GzB,GAAG,WAAW,eAAe;"}