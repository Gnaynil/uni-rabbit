{"version":3,"file":"category.js","sources":["../../../../../src/pages/category/category.vue","../../../../../uniPage:/cGFnZXMvY2F0ZWdvcnkvY2F0ZWdvcnkudnVl"],"sourcesContent":["//分类页 通过顶部高度设置一二级分类的响应式\n<script setup>\nimport { ref, computed, nextTick } from 'vue'\nimport { getHomeBannerAPI } from '@/services/home.js'\nimport { getCategoryTopAPI } from '@/services/category.js'\nimport { onLoad } from '@dcloudio/uni-app'\nimport PageSkeleton from './components/PageSkeleton.vue'\n//获取分类轮播图\nconst bannerList = ref([])\nconst getBannerList = async () => {\n  const res = await getHomeBannerAPI(2)\n  bannerList.value = res.result\n}\n//获取一级分类数据\nconst categoryTopList = ref([])\nconst getCategoryTopList = async () => {\n  const res = await getCategoryTopAPI()\n  categoryTopList.value = res.result\n}\n//获取一级分类中子集的数量\nconst categoryNumber = computed(() =>\n  categoryTopList.value.map((item) => {\n    return item.children.length\n  }),\n)\n//一级分类活跃状态响应式变量\nconst activeIndex = ref(0)\n// //提取二级分类数据\nconst subCategoryList = computed(() => {\n  //返回一个筛选出的新数组（二级分类的数据\n  return categoryTopList.value.flatMap((item) => item.children)\n})\n//数据是否加载完毕\nconst isFinish = ref(false)\n//实际高度\nconst actualHeight = ref(0)\n//滚动高度数组\nconst categoryHeight = ref([0])\n//二级分类子集中的索引值\nconst categoryIndex = ref(0)\n//获取每一项的滚动高度\nconst getCategoryHeight = () => {\n  //nextTick：在Dom更新完成后获取Dom节点\n  nextTick(() => {\n    // 创建一个SelectorQuery对象实例\n    const query = uni.createSelectorQuery()\n    // 总高度变量\n    let totalHeight = 0\n    // 遍历二级分类列表，使用.select为每个二级分类创建一个NodesRef对象实例存放到SelectorQuery对象实例\n    subCategoryList.value.forEach((item, index) => {\n      //根据ID匹配 .boundingClientRect()添加节点布局位置从而获取元素尺寸和位置\n      query.select(`#category-${index}`).boundingClientRect()\n    })\n    // 初始化索引变量\n    let index = 0\n    // 执行请求\n    query.exec((res) => {\n      //遍历所有对象获取节点信息\n      res.forEach((rect) => {\n        if (rect) {\n          // 累加当前分类的高度\n          totalHeight += rect.height\n          // 判断当前索引值是否等于一级里的二级分类数量和\n          if (index === categoryNumber.value[categoryIndex.value]) {\n            console.log(totalHeight)\n            categoryIndex.value++\n            index = 0\n            // 将当前总高度存入数组 因为存在误差所以减去590个像素点\n            categoryHeight.value.push(totalHeight - 590)\n          }\n          index++\n        }\n      })\n    })\n  })\n}\nonLoad(async () => {\n  //获取banner和分类数据\n  await Promise.all([getBannerList(), getCategoryTopList()])\n  //加载完毕\n  isFinish.value = true\n  await getCategoryHeight()\n})\nconst scrollToView = ref('')\nconst categoryChange = (index) => {\n  activeIndex.value = index\n  //根据每个一级分类内的子集获取每个大类第一个的位置 例如到达category-7第二个大类的首个节点\n  scrollToView.value = `category-${categoryNumber.value\n    .slice(0, index)\n    .reduce((acc, curr) => acc + curr, 0)}`\n}\n\nconst onScroll = (e) => {\n  const scrollTop = e.detail.scrollTop\n  //根据滚动条位置 设置一级分类状态\n  for (let i = 0; i < categoryHeight.value.length; i++) {\n    //根据分类高度进行判断\n    if (scrollTop >= categoryHeight.value[i] && scrollTop < categoryHeight.value[i + 1]) {\n      activeIndex.value = i\n      break\n    } else if (i === categoryHeight.value.length - 1 && scrollTop >= categoryHeight.value[i]) {\n      activeIndex.value = i\n      break\n    }\n  }\n}\n</script>\n\n<template>\n  <view class=\"viewport\" v-if=\"isFinish\">\n    <!-- 搜索框 -->\n    <view class=\"search\">\n      <view class=\"input\">\n        <text class=\"icon-search\">女靴</text>\n      </view>\n    </view>\n    <!-- 分类 -->\n    <view class=\"categories\">\n      <!-- 左侧：一级分类 -->\n      <scroll-view class=\"primary\" scroll-y>\n        <view\n          v-for=\"(item, index) in categoryTopList\"\n          :key=\"item.id\"\n          class=\"item\"\n          :class=\"{ active: index === activeIndex }\"\n          @tap=\"categoryChange(index)\"\n        >\n          <text class=\"name\"> {{ item.name }} </text>\n        </view>\n      </scroll-view>\n      <!-- 右侧：二级分类 -->\n      <!-- 焦点图 -->\n      <view class=\"secondary\">\n        <view class=\"banner\">\n          <XtxSwiper :data=\"bannerList\" />\n        </view>\n        <scroll-view scroll-y @scroll=\"onScroll\" :scroll-into-view=\"scrollToView\">\n          <!-- 内容区域 -->\n          <view\n            class=\"panel\"\n            v-for=\"(item, index) in subCategoryList\"\n            :key=\"item.id\"\n            :id=\"`category-${index}`\"\n          >\n            <view class=\"title\">\n              <text class=\"name\">{{ item.name }}</text>\n              <!-- <navigator class=\"more\" hover-class=\"none\">全部</navigator> -->\n            </view>\n            <view class=\"section\">\n              <navigator\n                v-for=\"goods in item.goods\"\n                :key=\"goods.id\"\n                class=\"goods\"\n                hover-class=\"none\"\n                :url=\"`/pages/goods/goods?id=${goods.id}`\"\n              >\n                <image class=\"image\" :src=\"goods.picture\"></image>\n                <view class=\"name ellipsis\">{{ goods.name }}</view>\n                <view class=\"price\">\n                  <text class=\"symbol\">¥</text>\n                  <text class=\"number\">{{ goods.price }}</text>\n                </view>\n              </navigator>\n            </view>\n          </view>\n          <view class=\"footer\">--已经到底啦--</view>\n        </scroll-view>\n      </view>\n    </view>\n  </view>\n  <!-- #ifdef MP-WEIXIN -->\n  <PageSkeleton v-else />\n  <!-- #endif -->\n</template>\n\n<style lang=\"scss\">\npage {\n  height: 100%;\n  overflow: hidden;\n}\n.viewport {\n  height: calc(100% - 202rpx);\n  display: flex;\n  flex-direction: column;\n}\n.search {\n  padding: 0 30rpx 20rpx;\n  background-color: #fff;\n  .input {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 64rpx;\n    padding-left: 26rpx;\n    color: #8b8b8b;\n    font-size: 28rpx;\n    border-radius: 32rpx;\n    background-color: #f3f4f4;\n  }\n}\n.icon-search {\n  &::before {\n    margin-right: 10rpx;\n  }\n}\n/* 分类 */\n.categories {\n  flex: 1;\n  min-height: 400rpx;\n  display: flex;\n}\n/* 一级分类 */\n.primary {\n  overflow: hidden;\n  width: 180rpx;\n  flex: none;\n  background-color: #f6f6f6;\n  height: 100vh;\n\n  .item {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 96rpx;\n    font-size: 26rpx;\n    color: #595c63;\n    position: relative;\n    &::after {\n      content: '';\n      position: absolute;\n      left: 42rpx;\n      bottom: 0;\n      width: 96rpx;\n      border-top: 1rpx solid #e3e4e7;\n    }\n  }\n  .active {\n    background-color: #fff;\n    &::before {\n      content: '';\n      position: absolute;\n      left: 0;\n      top: 0;\n      width: 8rpx;\n      height: 100%;\n      background-color: #27ba9b;\n    }\n  }\n}\n.primary .item:last-child::after,\n.primary .active::after {\n  display: none;\n}\n\n/* 二级分类 */\n.secondary {\n  background-color: #fff;\n  position: relative;\n  // overflow: auto;\n  .banner {\n    margin-bottom: 20px;\n  }\n  .carousel {\n    height: 200rpx;\n    margin: 0 30rpx 20rpx;\n    border-radius: 4rpx;\n    // overflow: hidden;\n  }\n  .panel {\n    margin: 0 30rpx 0rpx;\n  }\n  .title {\n    height: 60rpx;\n    line-height: 60rpx;\n    color: #333;\n    font-size: 28rpx;\n    border-bottom: 1rpx solid #f7f7f8;\n    background-color: #fff;\n    position: sticky;\n    left: 0;\n    top: 0;\n    z-index: 999;\n    .more {\n      float: right;\n      padding-left: 20rpx;\n      font-size: 24rpx;\n      color: #999;\n    }\n  }\n  .more {\n    &::after {\n      font-family: 'erabbit' !important;\n      content: '\\e6c2';\n    }\n  }\n  .section {\n    // #ifdef H5\n    width: 110% !important;\n    // #endif\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-wrap: wrap;\n    padding: 20rpx 0;\n    .goods {\n      width: 150rpx;\n      margin: 0rpx 30rpx 20rpx 0;\n      &:nth-child(3n) {\n        margin-right: 0;\n      }\n      image {\n        width: 150rpx;\n        height: 150rpx;\n      }\n      .name {\n        // #ifdef H5\n        height: 66rpx;\n        // #endif\n        padding: 5rpx;\n        font-size: 22rpx;\n        color: #333;\n      }\n      .price {\n        padding: 5rpx;\n        font-size: 18rpx;\n        color: #cf4444;\n      }\n      .number {\n        font-size: 24rpx;\n        margin-left: 2rpx;\n      }\n    }\n  }\n  .footer {\n    position: absolute;\n    left: 32%;\n    color: #e2e2e2;\n    padding-bottom: 100rpx;\n  }\n}\n</style>\n","import MiniProgramPage from 'D:/code/uni-rabbit/src/pages/category/category.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","getHomeBannerAPI","getCategoryTopAPI","computed","nextTick","uni","index","onLoad"],"mappings":";;;;;;;;;;;;;;;AAMA,MAAM,eAAe,MAAW;;;;AAEhC,UAAM,aAAaA,cAAG,IAAC,EAAE;AACzB,UAAM,gBAAgB,YAAY;AAChC,YAAM,MAAM,MAAMC,cAAgB,iBAAC,CAAC;AACpC,iBAAW,QAAQ,IAAI;AAAA,IACzB;AAEA,UAAM,kBAAkBD,cAAG,IAAC,EAAE;AAC9B,UAAM,qBAAqB,YAAY;AACrC,YAAM,MAAM,MAAME,oCAAmB;AACrC,sBAAgB,QAAQ,IAAI;AAAA,IAC9B;AAEA,UAAM,iBAAiBC,cAAAA;AAAAA,MAAS,MAC9B,gBAAgB,MAAM,IAAI,CAAC,SAAS;AAClC,eAAO,KAAK,SAAS;AAAA,MACzB,CAAG;AAAA,IACH;AAEA,UAAM,cAAcH,cAAG,IAAC,CAAC;AAEzB,UAAM,kBAAkBG,cAAQ,SAAC,MAAM;AAErC,aAAO,gBAAgB,MAAM,QAAQ,CAAC,SAAS,KAAK,QAAQ;AAAA,IAC9D,CAAC;AAED,UAAM,WAAWH,cAAG,IAAC,KAAK;AAELA,kBAAG,IAAC,CAAC;AAE1B,UAAM,iBAAiBA,cAAAA,IAAI,CAAC,CAAC,CAAC;AAE9B,UAAM,gBAAgBA,cAAG,IAAC,CAAC;AAE3B,UAAM,oBAAoB,MAAM;AAE9BI,oBAAAA,WAAS,MAAM;AAEb,cAAM,QAAQC,cAAG,MAAC,oBAAqB;AAEvC,YAAI,cAAc;AAElB,wBAAgB,MAAM,QAAQ,CAAC,MAAMC,WAAU;AAE7C,gBAAM,OAAO,aAAaA,MAAK,EAAE,EAAE,mBAAoB;AAAA,QAC7D,CAAK;AAED,YAAI,QAAQ;AAEZ,cAAM,KAAK,CAAC,QAAQ;AAElB,cAAI,QAAQ,CAAC,SAAS;AACpB,gBAAI,MAAM;AAER,6BAAe,KAAK;AAEpB,kBAAI,UAAU,eAAe,MAAM,cAAc,KAAK,GAAG;AACvD,wBAAQ,IAAI,WAAW;AACvB,8BAAc;AACd,wBAAQ;AAER,+BAAe,MAAM,KAAK,cAAc,GAAG;AAAA,cAC5C;AACD;AAAA,YACD;AAAA,UACT,CAAO;AAAA,QACP,CAAK;AAAA,MACL,CAAG;AAAA,IACH;AACAC,kBAAAA,OAAO,YAAY;AAEjB,YAAM,QAAQ,IAAI,CAAC,cAAa,GAAI,mBAAoB,CAAA,CAAC;AAEzD,eAAS,QAAQ;AACjB,YAAM,kBAAmB;AAAA,IAC3B,CAAC;AACD,UAAM,eAAeP,cAAG,IAAC,EAAE;AAC3B,UAAM,iBAAiB,CAAC,UAAU;AAChC,kBAAY,QAAQ;AAEpB,mBAAa,QAAQ,YAAY,eAAe,MAC7C,MAAM,GAAG,KAAK,EACd,OAAO,CAAC,KAAK,SAAS,MAAM,MAAM,CAAC,CAAC;AAAA,IACzC;AAEA,UAAM,WAAW,CAAC,MAAM;AACtB,YAAM,YAAY,EAAE,OAAO;AAE3B,eAAS,IAAI,GAAG,IAAI,eAAe,MAAM,QAAQ,KAAK;AAEpD,YAAI,aAAa,eAAe,MAAM,CAAC,KAAK,YAAY,eAAe,MAAM,IAAI,CAAC,GAAG;AACnF,sBAAY,QAAQ;AACpB;AAAA,QACD,WAAU,MAAM,eAAe,MAAM,SAAS,KAAK,aAAa,eAAe,MAAM,CAAC,GAAG;AACxF,sBAAY,QAAQ;AACpB;AAAA,QACD;AAAA,MACF;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxGA,GAAG,WAAW,eAAe;"}