{"version":3,"file":"goods.js","sources":["../../../../../src/pages/goods/goods.vue","../../../../../uniPage:/cGFnZXMvZ29vZHMvZ29vZHMudnVl"],"sourcesContent":["<script setup>\nimport { ref, computed } from 'vue'\nimport { getGoodsByIdAPI } from '@/services/goods.js'\nimport { postMemberCartAPI } from '@/services/cart.js'\nimport { onLoad } from '@dcloudio/uni-app'\nimport AddressPanel from './components/AddressPanel.vue'\nimport ServicePanel from './components/ServicePanel.vue'\nimport PageSkeleton from './components/PageSkeleton.vue'\n// 获取屏幕边界到安全区域距离\nconst { safeAreaInsets } = uni.getSystemInfoSync()\n\nconst props = defineProps({\n  id: {\n    type: String,\n    default: '',\n  },\n})\n//获取商品数据\nconst goodsList = ref([])\nconst getGoodsList = async () => {\n  const res = await getGoodsByIdAPI(props.id)\n  goodsList.value = res.result\n  //SKU所需组件格式\n  localdata.value = {\n    _id: res.result.id,\n    name: res.result.name,\n    goods_thumb: res.result.mainPictures[0],\n    spec_list: res.result.specs.map((v) => {\n      return { name: v.name, list: v.values }\n    }),\n    sku_list: res.result.skus.map((v) => {\n      return {\n        _id: v.id,\n        goods_id: res.result.id,\n        goods_name: res.result.name,\n        image: v.picture,\n        price: v.price * 100,\n        stock: v.inventory,\n        sku_name_arr: v.specs.map((vv) => vv.valueName),\n      }\n    }),\n  }\n}\nconst isFinish = ref(false)\nonLoad(async () => {\n  await getGoodsList()\n  isFinish.value = true\n})\n\n//轮播图变化时\nconst currentIndex = ref(0)\nconst onChange = (e) => {\n  currentIndex.value = e.detail.current\n}\n//点击图片放大\nconst onTapImage = (url) => {\n  uni.previewImage({\n    current: url,\n    urls: goodsList.value.mainPictures,\n  })\n}\nconst popup = ref()\nconst popupName = ref()\nconst openPopup = (name) => {\n  //修改弹出层\n  popupName.value = name\n  popup.value.open()\n}\n//已选择的地址\nconst selectedAddress = ref('')\nconst selectedId = ref('')\nconst sendAddress = (index) => {\n  selectedAddress.value =\n    goodsList.value.userAddresses[index].fullLocation +\n    ' ' +\n    goodsList.value.userAddresses[index].address\n  selectedId.value = goodsList.value.userAddresses[index].id\n}\n\n//是否显示SKU组件\nconst isShowSku = ref(false)\nconst localdata = ref({})\n\nconst mode = ref(1)\n//1:Both,2:Cart,3:Buy\nconst openSkuPopup = (val) => {\n  //显示SKU弹窗\n  isShowSku.value = true\n  //修改按钮模式\n  mode.value = val\n}\n//SKU组件实例\nconst skuPopupRef = ref()\n// 计算被选中的值\nconst selectArrText = computed(() => {\n  return skuPopupRef.value?.selectArr?.join(' ').trim() || '请选择商品规格'\n})\n//加入购物车事件\nconst onAddCart = async (e) => {\n  const res = await postMemberCartAPI({ skuId: e._id, count: e.buy_num })\n  uni.showToast({\n    title: '添加成功',\n  })\n  setTimeout(() => {\n    isShowSku.value = false\n  }, 500)\n}\n//立即购买事件\nconst onBuyNow = (e) => {\n  console.log(selectedId.value)\n  console.log(e)\n  uni.navigateTo({\n    url: `/pagesOrder/create/create?skuId=${e._id}&count=${e.buy_num}&addressId=${selectedId.value}`,\n  })\n}\n</script>\n\n<template>\n  <!-- SKU弹窗组件 -->\n  <vk-data-goods-sku-popup\n    v-model=\"isShowSku\"\n    :localdata=\"localdata\"\n    :mode=\"mode\"\n    add-cart-background-color=\"#FFA868\"\n    buy-now-background-color=\"#27BA9B\"\n    ref=\"skuPopupRef\"\n    :actived-style=\"{\n      color: '#27BA9B',\n      borderColor: '#27BA9B',\n      backgroundColor: '#E9F8F5',\n    }\"\n    @buy-now=\"onBuyNow\"\n    @add-cart=\"onAddCart\"\n  ></vk-data-goods-sku-popup>\n  <scroll-view scroll-y class=\"viewport\" v-if=\"isFinish\">\n    <!-- 基本信息 -->\n    <view class=\"goods\">\n      <!-- 商品主图 -->\n      <view class=\"preview\">\n        <swiper circular @change=\"onChange\">\n          <swiper-item v-for=\"(item, index) in goodsList?.mainPictures\" :key=\"item\">\n            <image mode=\"aspectFill\" :src=\"item\" @tap=\"onTapImage(item)\" />\n          </swiper-item>\n        </swiper>\n        <view class=\"indicator\">\n          <text class=\"current\">{{ currentIndex + 1 }}</text>\n          <text class=\"split\">/</text>\n          <text class=\"total\">{{ goodsList?.mainPictures?.length }}</text>\n        </view>\n      </view>\n\n      <!-- 商品简介 -->\n      <view class=\"meta\">\n        <view class=\"price\">\n          <text class=\"symbol\">¥</text>\n          <text class=\"number\">{{ goodsList.price }}</text>\n        </view>\n        <view class=\"name ellipsis\">{{ goodsList.name }} </view>\n        <view class=\"desc\">{{ goodsList.desc }}</view>\n      </view>\n\n      <!-- 操作面板 -->\n      <view class=\"action\">\n        <view class=\"item arrow\">\n          <text class=\"label\">选择</text>\n          <text class=\"text ellipsis\" @tap=\"openSkuPopup(1)\"> {{ selectArrText }} </text>\n        </view>\n        <view class=\"item arrow\" @tap=\"openPopup('address')\">\n          <text class=\"label\">送至</text>\n          <text class=\"text ellipsis\" v-if=\"selectedAddress\"> {{ selectedAddress }} </text>\n          <text class=\"text ellipsis\" v-else> 请选择收货地址 </text>\n        </view>\n        <view class=\"item arrow\" @tap=\"openPopup('service')\">\n          <text class=\"label\">服务</text>\n          <text class=\"text ellipsis\"> 无忧退 快速退款 免费包邮 </text>\n        </view>\n      </view>\n    </view>\n\n    <!-- 商品详情 -->\n    <view class=\"detail panel\">\n      <view class=\"title\">\n        <text>详情</text>\n      </view>\n      <view class=\"content\">\n        <view class=\"properties\">\n          <!-- 属性详情 -->\n          <view class=\"item\" v-for=\"item in goodsList.details?.properties\" :key=\"item.name\">\n            <text class=\"label\">{{ item.name }}</text>\n            <text class=\"value\">{{ item.value }}</text>\n          </view>\n        </view>\n        <!-- 图片详情 -->\n        <image\n          mode=\"widthFix\"\n          v-for=\"item in goodsList.details?.pictures\"\n          :key=\"item\"\n          :src=\"item\"\n        ></image>\n      </view>\n    </view>\n\n    <!-- 同类推荐 -->\n    <view class=\"similar panel\">\n      <view class=\"title\">\n        <text>同类推荐</text>\n      </view>\n      <view class=\"content\">\n        <navigator\n          v-for=\"item in goodsList.similarProducts\"\n          :key=\"item.id\"\n          class=\"goods\"\n          hover-class=\"none\"\n          :url=\"`/pages/goods/goods?id=${item.id}`\"\n        >\n          <image class=\"image\" mode=\"aspectFill\" :src=\"item.picture\"></image>\n          <view class=\"name ellipsis\">{{ item.name }}</view>\n          <view class=\"price\">\n            <text class=\"symbol\">¥</text>\n            <text class=\"number\">{{ item.price }}</text>\n          </view>\n        </navigator>\n      </view>\n    </view>\n  </scroll-view>\n  <PageSkeleton v-else />\n  <!-- 用户操作 -->\n  <view class=\"toolbar\" :style=\"{ paddingBottom: safeAreaInsets?.bottom + 'px' }\">\n    <view class=\"icons\">\n      <button class=\"icons-button\"><text class=\"icon-heart\"></text>收藏</button>\n      <button class=\"icons-button\" open-type=\"contact\">\n        <text class=\"icon-handset\"></text>客服\n      </button>\n      <navigator class=\"icons-button\" url=\"/pages/cart/cart2\">\n        <text class=\"icon-cart\"></text>购物车\n      </navigator>\n    </view>\n    <view class=\"buttons\">\n      <view class=\"addcart\" @tap=\"openSkuPopup(2)\"> 加入购物车 </view>\n      <view class=\"buynow\" @tap=\"openSkuPopup(3)\"> 立即购买 </view>\n    </view>\n  </view>\n  <uni-popup ref=\"popup\" type=\"bottom\" backgroundColor=\"#fff\">\n    <AddressPanel\n      v-show=\"popupName === 'address'\"\n      @close=\"popup?.close()\"\n      @index=\"sendAddress\"\n      :address=\"goodsList.userAddresses\"\n    />\n    <ServicePanel v-show=\"popupName === 'service'\" @close=\"popup?.close()\" />\n  </uni-popup>\n</template>\n\n<style lang=\"scss\">\npage {\n  height: 100%;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n\n.viewport {\n  background-color: #f4f4f4;\n}\n\n.panel {\n  margin-top: 20rpx;\n  background-color: #fff;\n  .title {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    height: 90rpx;\n    line-height: 1;\n    padding: 30rpx 60rpx 30rpx 6rpx;\n    position: relative;\n    text {\n      padding-left: 10rpx;\n      font-size: 28rpx;\n      color: #333;\n      font-weight: 600;\n      border-left: 4rpx solid #27ba9b;\n    }\n    navigator {\n      font-size: 24rpx;\n      color: #666;\n    }\n  }\n}\n\n.arrow {\n  &::after {\n    position: absolute;\n    top: 50%;\n    right: 30rpx;\n    content: '\\e6c2';\n    color: #ccc;\n    font-family: 'erabbit' !important;\n    font-size: 32rpx;\n    transform: translateY(-50%);\n  }\n}\n\n/* 商品信息 */\n.goods {\n  background-color: #fff;\n  .preview {\n    height: 750rpx;\n    position: relative;\n    .image {\n      width: 750rpx;\n      height: 750rpx;\n    }\n    .indicator {\n      height: 40rpx;\n      padding: 0 24rpx;\n      line-height: 40rpx;\n      border-radius: 30rpx;\n      color: #fff;\n      font-family: Arial, Helvetica, sans-serif;\n      background-color: rgba(0, 0, 0, 0.3);\n      position: absolute;\n      bottom: 30rpx;\n      right: 30rpx;\n      .current {\n        font-size: 26rpx;\n      }\n      .split {\n        font-size: 24rpx;\n        margin: 0 1rpx 0 2rpx;\n      }\n      .total {\n        font-size: 24rpx;\n      }\n    }\n  }\n  .meta {\n    position: relative;\n    border-bottom: 1rpx solid #eaeaea;\n    .price {\n      height: 130rpx;\n      padding: 25rpx 30rpx 0;\n      color: #fff;\n      font-size: 34rpx;\n      box-sizing: border-box;\n      background-color: #35c8a9;\n    }\n    .number {\n      font-size: 56rpx;\n    }\n    .brand {\n      width: 160rpx;\n      height: 80rpx;\n      overflow: hidden;\n      position: absolute;\n      top: 26rpx;\n      right: 30rpx;\n    }\n    .name {\n      max-height: 88rpx;\n      line-height: 1.4;\n      margin: 20rpx;\n      font-size: 32rpx;\n      color: #333;\n    }\n    .desc {\n      line-height: 1;\n      padding: 0 20rpx 30rpx;\n      font-size: 24rpx;\n      color: #cf4444;\n    }\n  }\n  .action {\n    padding-left: 20rpx;\n    .item {\n      height: 90rpx;\n      padding-right: 60rpx;\n      border-bottom: 1rpx solid #eaeaea;\n      font-size: 26rpx;\n      color: #333;\n      position: relative;\n      display: flex;\n      align-items: center;\n      &:last-child {\n        border-bottom: 0 none;\n      }\n    }\n    .label {\n      width: 60rpx;\n      color: #898b94;\n      margin: 0 16rpx 0 10rpx;\n    }\n    .text {\n      flex: 1;\n      -webkit-line-clamp: 1;\n    }\n  }\n}\n\n/* 商品详情 */\n.detail {\n  padding-left: 20rpx;\n  .content {\n    margin-left: -20rpx;\n    .image {\n      width: 100%;\n    }\n  }\n  .properties {\n    padding: 0 20rpx;\n    margin-bottom: 30rpx;\n    .item {\n      display: flex;\n      line-height: 2;\n      padding: 10rpx;\n      font-size: 26rpx;\n      color: #333;\n      border-bottom: 1rpx dashed #ccc;\n    }\n    .label {\n      width: 200rpx;\n    }\n    .value {\n      flex: 1;\n    }\n  }\n}\n\n/* 同类推荐 */\n.similar {\n  .content {\n    padding: 0 20rpx 200rpx;\n    background-color: #f4f4f4;\n    display: flex;\n    flex-wrap: wrap;\n    .goods {\n      width: 340rpx;\n      padding: 24rpx 20rpx 20rpx;\n      margin: 20rpx 7rpx;\n      border-radius: 10rpx;\n      background-color: #fff;\n    }\n    .image {\n      width: 300rpx;\n      height: 260rpx;\n    }\n    .name {\n      height: 80rpx;\n      margin: 10rpx 0;\n      font-size: 26rpx;\n      color: #262626;\n    }\n    .price {\n      line-height: 1;\n      font-size: 20rpx;\n      color: #cf4444;\n    }\n    .number {\n      font-size: 26rpx;\n      margin-left: 2rpx;\n    }\n  }\n  navigator {\n    &:nth-child(even) {\n      margin-right: 0;\n    }\n  }\n}\n\n/* 底部工具栏 */\n.toolbar {\n  position: fixed;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  z-index: 1;\n  background-color: #fff;\n  height: 100rpx;\n  padding: 0 20rpx var(--window-bottom);\n  border-top: 1rpx solid #eaeaea;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  box-sizing: content-box;\n  .buttons {\n    display: flex;\n    & > view {\n      width: 220rpx;\n      text-align: center;\n      line-height: 72rpx;\n      font-size: 26rpx;\n      color: #fff;\n      border-radius: 72rpx;\n    }\n    .addcart {\n      background-color: #ffa868;\n    }\n    .buynow,\n    .payment {\n      background-color: #27ba9b;\n      margin-left: 20rpx;\n    }\n  }\n  .icons {\n    padding-right: 10rpx;\n    display: flex;\n    align-items: center;\n    flex: 1;\n    .icons-button {\n      flex: 1;\n      text-align: center;\n      line-height: 1.4;\n      padding: 0;\n      margin: 0;\n      border-radius: 0;\n      font-size: 20rpx;\n      color: #333;\n      background-color: #fff;\n      &::after {\n        border: none;\n      }\n    }\n    text {\n      display: block;\n      font-size: 34rpx;\n    }\n  }\n}\n</style>\n","import MiniProgramPage from 'D:/code/uni-rabbit/src/pages/goods/goods.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","ref","getGoodsByIdAPI","onLoad","computed","postMemberCartAPI"],"mappings":"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"}