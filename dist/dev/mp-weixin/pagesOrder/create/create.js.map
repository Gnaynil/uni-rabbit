{"version":3,"file":"create.js","sources":["../../../../../src/pagesOrder/create/create.vue","../../../../../uniPage:/cGFnZXNPcmRlclxjcmVhdGVcY3JlYXRlLnZ1ZQ"],"sourcesContent":["<script setup>\nimport { computed, ref } from 'vue'\nimport {\n  getMemberOrderPreAPI,\n  getMemberOrderPreNowAPI,\n  postMemberOrderAPI,\n  getMemberOrderPreAgainAPI,\n} from '@/services/order.js'\nimport { onLoad, onShow } from '@dcloudio/uni-app'\nimport { useAddressStore } from '@/stores/address.js'\nconst orderList = ref([])\n\n// 获取屏幕边界到安全区域距离\nconst { safeAreaInsets } = uni.getSystemInfoSync()\n// 订单备注\nconst buyerMessage = ref('')\n// 配送时间\nconst deliveryList = ref([\n  { type: 1, text: '时间不限 (周一至周日)' },\n  { type: 2, text: '工作日送 (周一至周五)' },\n  { type: 3, text: '周末配送 (周六至周日)' },\n])\n// 当前配送时间下标\nconst activeIndex = ref(0)\n// 当前配送时间\nconst activeDelivery = computed(() => deliveryList.value[activeIndex.value])\n// 修改配送时间\nconst onChangeDelivery = (ev) => {\n  activeIndex.value = ev.detail.value\n}\n\n//获取立即购买数据\nconst query = defineProps({\n  skuId: {\n    type: String,\n    default: '',\n  },\n  count: {\n    type: String,\n    default: '',\n  },\n  addressId: {\n    type: String,\n    default: '',\n  },\n  //再次购买Id\n  orderId: {\n    type: String,\n  },\n})\nconsole.log(query.orderId)\n//获取订单信息\nconst getOrderList = async () => {\n  console.log(query.orderId)\n  if (query.skuId && query.count) {\n    //通过skuId addressId获取立即购买所需其他数据信息\n    const res = await getMemberOrderPreNowAPI({\n      count: query.count,\n      skuId: query.skuId,\n      addressId: query.addressId,\n    })\n    orderList.value = res.result\n    // console.log(orderList.value)\n  }\n  //再次购买 通过id获取其他数据\n  else if (query.orderId) {\n    const res = await getMemberOrderPreAgainAPI(query.orderId)\n    orderList.value = res.result\n  } else {\n    //获取购物车里订单信息\n    const res = await getMemberOrderPreAPI()\n    orderList.value = res.result\n    // console.log(orderList.value)\n  }\n}\n//页面展示时调用\nonShow(() => getOrderList())\n//初始化收货地址\nonLoad(() => {\n  addressStore.selectedAddress = undefined\n})\n//计算默认收货地址\nconst addressStore = useAddressStore()\nconst selectedAddress = computed(() => {\n  //判断是立即购买里转入 还是从购物车转入\n  if (orderList.value?.userAddresses?.length === 1) {\n    return addressStore.selectedAddress?.id\n      ? addressStore.selectedAddress\n      : orderList.value?.userAddresses[0]\n  } else {\n    return addressStore.selectedAddress?.id\n      ? addressStore.selectedAddress\n      : orderList.value?.userAddresses?.find((v) => v.isDefault)\n  }\n})\n\n//提交订单\nconst onOrderSubmit = async () => {\n  //没有收货地址提醒\n  if (!selectedAddress.value.id) {\n    return uni.showToast({\n      icon: 'none',\n      title: '请选择收货地址',\n    })\n  }\n  //发送请求\n  const res = await postMemberOrderAPI({\n    addressId: selectedAddress.value.id,\n    buyerMessage: buyerMessage.value,\n    deliveryTimeType: activeDelivery.value.type,\n    goods: orderList.value.goods.map((v) => {\n      return { count: v.count, skuId: v.skuId }\n    }),\n    payChannel: 2,\n    payType: 1,\n  })\n  // 关闭当前页面，跳转到订单详情，传递订单id\n  uni.redirectTo({\n    url: `/pagesOrder/detail/detail?id=${res.result.id}`,\n  })\n}\n</script>\n\n<template>\n  <scroll-view scroll-y class=\"viewport\">\n    <!-- 收货地址 -->\n    <navigator\n      v-if=\"selectedAddress\"\n      class=\"shipment\"\n      hover-class=\"none\"\n      url=\"/pagesMember/address/address?from=order\"\n    >\n      <view class=\"user\"> {{ selectedAddress.receiver }} {{ selectedAddress.contact }} </view>\n      <view class=\"address\">\n        {{ selectedAddress.fullLocation + ' ' + selectedAddress.address }}</view\n      >\n      <text class=\"icon icon-right\"></text>\n    </navigator>\n    <navigator\n      v-else\n      class=\"shipment\"\n      hover-class=\"none\"\n      url=\"/pagesMember/address/address?from=order\"\n    >\n      <view class=\"address\"> 请选择收货地址 </view>\n      <text class=\"icon icon-right\"></text>\n    </navigator>\n\n    <!-- 商品信息 -->\n    <view class=\"goods\">\n      <navigator\n        v-for=\"item in orderList.goods\"\n        :key=\"item.id\"\n        :url=\"`/pages/goods/goods?id=${item.id}`\"\n        class=\"item\"\n        hover-class=\"none\"\n      >\n        <image class=\"picture\" :src=\"item.picture\" />\n        <view class=\"meta\">\n          <view class=\"name ellipsis\"> {{ item.name }} </view>\n          <view class=\"attrs\">{{ item.attrsText }}</view>\n          <view class=\"prices\">\n            <view class=\"pay-price symbol\">{{ item.payPrice }}</view>\n            <view class=\"price symbol\">{{ item.price }}</view>\n          </view>\n          <view class=\"count\">{{ item.count }}</view>\n        </view>\n      </navigator>\n    </view>\n\n    <!-- 配送及支付方式 -->\n    <view class=\"related\">\n      <view class=\"item\">\n        <text class=\"text\">配送时间</text>\n        <picker :range=\"deliveryList\" range-key=\"text\" @change=\"onChangeDelivery\">\n          <view class=\"icon-fonts picker\">{{ activeDelivery.text }}</view>\n        </picker>\n      </view>\n      <view class=\"item\">\n        <text class=\"text\">订单备注</text>\n        <input\n          class=\"input\"\n          :cursor-spacing=\"30\"\n          placeholder=\"选填，建议留言前先与商家沟通确认\"\n          v-model=\"buyerMessage\"\n        />\n      </view>\n    </view>\n\n    <!-- 支付金额 -->\n    <view class=\"settlement\">\n      <view class=\"item\">\n        <text class=\"text\">商品总价: </text>\n        <text class=\"number symbol\">{{ orderList?.summary?.totalPrice.toFixed(2) }}</text>\n      </view>\n      <view class=\"item\">\n        <text class=\"text\">运费: </text>\n        <text class=\"number symbol\">{{ orderList?.summary?.postFee.toFixed(2) }}</text>\n      </view>\n    </view>\n  </scroll-view>\n\n  <!-- 吸底工具栏 -->\n  <view class=\"toolbar\" :style=\"{ paddingBottom: safeAreaInsets?.bottom + 'px' }\">\n    <view class=\"total-pay symbol\">\n      <text class=\"number\">{{ orderList.summary?.totalPayPrice.toFixed(2) }}</text>\n    </view>\n    <view class=\"button\" :class=\"{ disabled: selecteAddress?.id }\" @tap=\"onOrderSubmit\">\n      提交订单\n    </view>\n  </view>\n  <!-- 底部占位空盒子 -->\n  <view class=\"toolbar-height\"></view>\n</template>\n\n<style lang=\"scss\">\npage {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  overflow: hidden;\n  background-color: #f4f4f4;\n}\n\n.symbol::before {\n  content: '¥';\n  font-size: 80%;\n  margin-right: 5rpx;\n}\n\n.shipment {\n  margin: 20rpx;\n  padding: 30rpx 30rpx 30rpx 84rpx;\n  font-size: 26rpx;\n  border-radius: 10rpx;\n  background: url(https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/images/locate.png)\n    20rpx center / 50rpx no-repeat #fff;\n  position: relative;\n\n  .icon {\n    font-size: 36rpx;\n    color: #333;\n    transform: translateY(-50%);\n    position: absolute;\n    top: 50%;\n    right: 20rpx;\n  }\n\n  .user {\n    color: #333;\n    margin-bottom: 5rpx;\n  }\n\n  .address {\n    color: #666;\n  }\n}\n\n.goods {\n  margin: 20rpx;\n  padding: 0 20rpx;\n  border-radius: 10rpx;\n  background-color: #fff;\n\n  .item {\n    display: flex;\n    padding: 30rpx 0;\n    border-top: 1rpx solid #eee;\n\n    &:first-child {\n      border-top: none;\n    }\n\n    .picture {\n      width: 170rpx;\n      height: 170rpx;\n      border-radius: 10rpx;\n      margin-right: 20rpx;\n    }\n\n    .meta {\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      position: relative;\n    }\n\n    .name {\n      height: 80rpx;\n      font-size: 26rpx;\n      color: #444;\n    }\n\n    .attrs {\n      line-height: 1.8;\n      padding: 0 15rpx;\n      margin-top: 6rpx;\n      font-size: 24rpx;\n      align-self: flex-start;\n      border-radius: 4rpx;\n      color: #888;\n      background-color: #f7f7f8;\n    }\n\n    .prices {\n      display: flex;\n      align-items: baseline;\n      margin-top: 6rpx;\n      font-size: 28rpx;\n\n      .pay-price {\n        margin-right: 10rpx;\n        color: #cf4444;\n      }\n\n      .price {\n        font-size: 24rpx;\n        color: #999;\n        text-decoration: line-through;\n      }\n    }\n\n    .count {\n      position: absolute;\n      bottom: 0;\n      right: 0;\n      font-size: 26rpx;\n      color: #444;\n    }\n  }\n}\n\n.related {\n  margin: 20rpx;\n  padding: 0 20rpx;\n  border-radius: 10rpx;\n  background-color: #fff;\n\n  .item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    min-height: 80rpx;\n    font-size: 26rpx;\n    color: #333;\n  }\n\n  .input {\n    flex: 1;\n    text-align: right;\n    margin: 20rpx 0;\n    padding-right: 20rpx;\n    font-size: 26rpx;\n    color: #999;\n  }\n\n  .item .text {\n    width: 125rpx;\n  }\n\n  .picker {\n    color: #666;\n  }\n\n  .picker::after {\n    content: '\\e6c2';\n  }\n}\n\n/* 结算清单 */\n.settlement {\n  margin: 20rpx;\n  padding: 0 20rpx;\n  border-radius: 10rpx;\n  background-color: #fff;\n  // padding-bottom: 100px;\n  .item {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    height: 80rpx;\n    font-size: 26rpx;\n    color: #333;\n  }\n\n  .danger {\n    color: #cf4444;\n  }\n}\n\n/* 吸底工具栏 */\n.toolbar {\n  position: fixed;\n  left: 0;\n  right: 0;\n  bottom: calc(var(--window-bottom));\n  z-index: 1;\n\n  background-color: #fff;\n  height: 100rpx;\n  padding: 0 20rpx;\n  border-top: 1rpx solid #eaeaea;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  box-sizing: content-box;\n\n  .total-pay {\n    font-size: 40rpx;\n    color: #cf4444;\n\n    .decimal {\n      font-size: 75%;\n    }\n  }\n\n  .button {\n    width: 220rpx;\n    text-align: center;\n    line-height: 72rpx;\n    font-size: 26rpx;\n    color: #fff;\n    border-radius: 72rpx;\n    background-color: #27ba9b;\n  }\n\n  .disabled {\n    opacity: 0.6;\n  }\n}\n// 底部占位空盒子\n.toolbar-height {\n  height: 165rpx;\n}\n</style>\n","import MiniProgramPage from 'D:/code/uni-rabbit/src/pagesOrder/create/create.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","computed","getMemberOrderPreNowAPI","getMemberOrderPreAgainAPI","getMemberOrderPreAPI","onShow","onLoad","useAddressStore","postMemberOrderAPI"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAUA,UAAM,YAAYA,cAAG,IAAC,EAAE;AAGxB,UAAM,EAAE,eAAc,IAAKC,cAAG,MAAC,kBAAmB;AAElD,UAAM,eAAeD,cAAG,IAAC,EAAE;AAE3B,UAAM,eAAeA,cAAAA,IAAI;AAAA,MACvB,EAAE,MAAM,GAAG,MAAM,eAAgB;AAAA,MACjC,EAAE,MAAM,GAAG,MAAM,eAAgB;AAAA,MACjC,EAAE,MAAM,GAAG,MAAM,eAAgB;AAAA,IACnC,CAAC;AAED,UAAM,cAAcA,cAAG,IAAC,CAAC;AAEzB,UAAM,iBAAiBE,cAAQ,SAAC,MAAM,aAAa,MAAM,YAAY,KAAK,CAAC;AAE3E,UAAM,mBAAmB,CAAC,OAAO;AAC/B,kBAAY,QAAQ,GAAG,OAAO;AAAA,IAChC;AAqBA,YAAQ,IAAI,MAAM,OAAO;AAEzB,UAAM,eAAe,YAAY;AAC/B,cAAQ,IAAI,MAAM,OAAO;AACzB,UAAI,MAAM,SAAS,MAAM,OAAO;AAE9B,cAAM,MAAM,MAAMC,uCAAwB;AAAA,UACxC,OAAO,MAAM;AAAA,UACb,OAAO,MAAM;AAAA,UACb,WAAW,MAAM;AAAA,QACvB,CAAK;AACD,kBAAU,QAAQ,IAAI;AAAA,MAEvB,WAEQ,MAAM,SAAS;AACtB,cAAM,MAAM,MAAMC,yCAA0B,MAAM,OAAO;AACzD,kBAAU,QAAQ,IAAI;AAAA,MAC1B,OAAS;AAEL,cAAM,MAAM,MAAMC,oCAAsB;AACxC,kBAAU,QAAQ,IAAI;AAAA,MAEvB;AAAA,IACH;AAEAC,kBAAAA,OAAO,MAAM,aAAY,CAAE;AAE3BC,kBAAAA,OAAO,MAAM;AACX,mBAAa,kBAAkB;AAAA,IACjC,CAAC;AAED,UAAM,eAAeC,eAAAA,gBAAiB;AACtC,UAAM,kBAAkBN,cAAQ,SAAC,MAAM;;AAErC,YAAI,qBAAU,UAAV,mBAAiB,kBAAjB,mBAAgC,YAAW,GAAG;AAChD,iBAAO,kBAAa,oBAAb,mBAA8B,MACjC,aAAa,mBACb,eAAU,UAAV,mBAAiB,cAAc;AAAA,MACvC,OAAS;AACL,iBAAO,kBAAa,oBAAb,mBAA8B,MACjC,aAAa,mBACb,qBAAU,UAAV,mBAAiB,kBAAjB,mBAAgC,KAAK,CAAC,MAAM,EAAE;AAAA,MACnD;AAAA,IACH,CAAC;AAGD,UAAM,gBAAgB,YAAY;AAEhC,UAAI,CAAC,gBAAgB,MAAM,IAAI;AAC7B,eAAOD,cAAAA,MAAI,UAAU;AAAA,UACnB,MAAM;AAAA,UACN,OAAO;AAAA,QACb,CAAK;AAAA,MACF;AAED,YAAM,MAAM,MAAMQ,kCAAmB;AAAA,QACnC,WAAW,gBAAgB,MAAM;AAAA,QACjC,cAAc,aAAa;AAAA,QAC3B,kBAAkB,eAAe,MAAM;AAAA,QACvC,OAAO,UAAU,MAAM,MAAM,IAAI,CAAC,MAAM;AACtC,iBAAO,EAAE,OAAO,EAAE,OAAO,OAAO,EAAE,MAAO;AAAA,QAC/C,CAAK;AAAA,QACD,YAAY;AAAA,QACZ,SAAS;AAAA,MACb,CAAG;AAEDR,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,gCAAgC,IAAI,OAAO,EAAE;AAAA,MACtD,CAAG;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvHA,GAAG,WAAW,eAAe;"}