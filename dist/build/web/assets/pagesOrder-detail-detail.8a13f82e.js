import{U as t,o as e,c as s,w as a,q as l,b as o,t as n,H as u,a as i,d as r,e as d,g as c,l as f,a1 as p,h as y,f as h,F as m,m as _,r as v,a2 as w,$ as g,x as b,j as k,n as S,X as x,s as C,i as T}from"./index-af18ee11.js";import{_ as F}from"./_plugin-vue_export-helper.1b428a4d.js";import{b as D,o as I,r as M}from"./uni-app.es.6b8c51ac.js";import{u as O,_ as j}from"./XtxGuess.5167860d.js";import{_ as B}from"./uni-popup.665f5863.js";import{c as z,d as H,e as R,f as $,h as N}from"./order.18c49d40.js";import"./home.b7557d0f.js";import"./http.84d8a07a.js";const U={en:{"uni-countdown.day":"day","uni-countdown.h":"h","uni-countdown.m":"m","uni-countdown.s":"s"},"zh-Hans":{"uni-countdown.day":"天","uni-countdown.h":"时","uni-countdown.m":"分","uni-countdown.s":"秒"},"zh-Hant":{"uni-countdown.day":"天","uni-countdown.h":"時","uni-countdown.m":"分","uni-countdown.s":"秒"}},{t:q}=t(U);const X=F({name:"UniCountdown",emits:["timeup"],props:{showDay:{type:Boolean,default:!0},showHour:{type:Boolean,default:!0},showMinute:{type:Boolean,default:!0},showColon:{type:Boolean,default:!0},start:{type:Boolean,default:!0},backgroundColor:{type:String,default:""},color:{type:String,default:"#333"},fontSize:{type:Number,default:14},splitorColor:{type:String,default:"#333"},day:{type:Number,default:0},hour:{type:Number,default:0},minute:{type:Number,default:0},second:{type:Number,default:0},timestamp:{type:Number,default:0}},data:()=>({timer:null,syncFlag:!1,d:"00",h:"00",i:"00",s:"00",leftTime:0,seconds:0}),computed:{dayText:()=>q("uni-countdown.day"),hourText:t=>q("uni-countdown.h"),minuteText:t=>q("uni-countdown.m"),secondText:t=>q("uni-countdown.s"),timeStyle(){const{color:t,backgroundColor:e,fontSize:s}=this;return{color:t,backgroundColor:e,fontSize:`${s}px`,width:22*s/14+"px",lineHeight:20*s/14+"px",borderRadius:3*s/14+"px"}},splitorStyle(){const{splitorColor:t,fontSize:e,backgroundColor:s}=this;return{color:t,fontSize:12*e/14+"px",margin:s?4*e/14+"px":""}}},watch:{day(t){this.changeFlag()},hour(t){this.changeFlag()},minute(t){this.changeFlag()},second(t){this.changeFlag()},start:{immediate:!0,handler(t,e){if(t)this.startData();else{if(!e)return;clearInterval(this.timer)}}}},created:function(t){this.seconds=this.toSeconds(this.timestamp,this.day,this.hour,this.minute,this.second),this.countDown()},unmounted(){clearInterval(this.timer)},methods:{toSeconds:(t,e,s,a,l)=>t?t-parseInt((new Date).getTime()/1e3,10):60*e*60*24+60*s*60+60*a+l,timeUp(){clearInterval(this.timer),this.$emit("timeup")},countDown(){let t=this.seconds,[e,s,a,l]=[0,0,0,0];t>0?(e=Math.floor(t/86400),s=Math.floor(t/3600)-24*e,a=Math.floor(t/60)-24*e*60-60*s,l=Math.floor(t)-24*e*60*60-60*s*60-60*a):this.timeUp(),e<10&&(e="0"+e),s<10&&(s="0"+s),a<10&&(a="0"+a),l<10&&(l="0"+l),this.d=e,this.h=s,this.i=a,this.s=l},startData(){if(this.seconds=this.toSeconds(this.timestamp,this.day,this.hour,this.minute,this.second),this.seconds<=0)return this.seconds=this.toSeconds(0,0,0,0,0),void this.countDown();clearInterval(this.timer),this.countDown(),this.timer=setInterval((()=>{this.seconds--,this.seconds<0?this.timeUp():this.countDown()}),1e3)},update(){this.startData()},changeFlag(){this.syncFlag||(this.seconds=this.toSeconds(this.timestamp,this.day,this.hour,this.minute,this.second),this.startData(),this.syncFlag=!0)}}},[["render",function(t,c,f,p,y,h){const m=r,_=d;return e(),s(_,{class:"uni-countdown"},{default:a((()=>[f.showDay?(e(),s(m,{key:0,style:l([h.timeStyle]),class:"uni-countdown__number"},{default:a((()=>[o(n(y.d),1)])),_:1},8,["style"])):u("",!0),f.showDay?(e(),s(m,{key:1,style:l([h.splitorStyle]),class:"uni-countdown__splitor"},{default:a((()=>[o(n(h.dayText),1)])),_:1},8,["style"])):u("",!0),f.showHour?(e(),s(m,{key:2,style:l([h.timeStyle]),class:"uni-countdown__number"},{default:a((()=>[o(n(y.h),1)])),_:1},8,["style"])):u("",!0),f.showHour?(e(),s(m,{key:3,style:l([h.splitorStyle]),class:"uni-countdown__splitor"},{default:a((()=>[o(n(f.showColon?":":h.hourText),1)])),_:1},8,["style"])):u("",!0),f.showMinute?(e(),s(m,{key:4,style:l([h.timeStyle]),class:"uni-countdown__number"},{default:a((()=>[o(n(y.i),1)])),_:1},8,["style"])):u("",!0),f.showMinute?(e(),s(m,{key:5,style:l([h.splitorStyle]),class:"uni-countdown__splitor"},{default:a((()=>[o(n(f.showColon?":":h.minuteText),1)])),_:1},8,["style"])):u("",!0),i(m,{style:l([h.timeStyle]),class:"uni-countdown__number"},{default:a((()=>[o(n(y.s),1)])),_:1},8,["style"]),f.showColon?u("",!0):(e(),s(m,{key:6,style:l([h.splitorStyle]),class:"uni-countdown__splitor"},{default:a((()=>[o(n(h.secondText),1)])),_:1},8,["style"]))])),_:1})}],["__scopeId","data-v-39e2e2ed"]]),A=F({__name:"detail",props:{id:String},setup(t){const F=t,{safeAreaInsets:U}=c(),{guessRef:q,onScrolltolower:A}=O(),G=f(),P=f(["商品无货","不想要了","商品信息填错了","地址信息填写错误","商品降价","其它"]),E=f(""),J=p(),K=J.at(-1);D((()=>{K.animate(".navbar",[{backgroundColor:"transparent"},{backgroundColor:"#f8f8f8"}],1e3,{scrollSource:"#scroller",startScrollOffset:0,endScrollOffset:50,timeRange:1e3}),K.animate(".navbar .title",[{color:"transparent"},{color:"#000"}],1e3,{scrollSource:"#scroller",timeRange:1e3,startScrollOffset:0,endScrollOffset:50}),K.animate(".navbar .back",[{color:"#fff"},{color:"#000"}],1e3,{scrollSource:"#scroller",timeRange:1e3,startScrollOffset:0,endScrollOffset:50})}));const L=[{id:0,text:""},{id:1,text:"待付款"},{id:2,text:"待发货"},{id:3,text:"待收货"},{id:4,text:"待评价"},{id:5,text:"已完成"},{id:6,text:"已取消"}],Q=f();I((()=>(async()=>{const t=await z(F.id);Q.value=t.result,[L[3].id,L[4].id,,L[5].id].includes(Q.value.orderState)&&et()})()));const V=()=>{Q.value.orderState=L[6].id},W=async()=>{g({url:`/pagesOrder/payment/payment?id=${F.id}`})},Y=async()=>{},Z=()=>{b({content:"为保障您的权益，请收到货并确认无误后，再确认收货",success:async t=>{if(console.log(t),t.confirm){const t=await R(F.id);Q.value=t.result}}})},tt=f([]),et=async()=>{const t=await H(F.id);tt.value=t.result.list},st=()=>{b({content:"是否删除订单",success:async t=>{t.confirm&&(await $({ids:[F.id]}),g({url:"/pagesOrder/list/list"}))}})};return(t,c)=>{var f;const p=k,b=d,D=r,I=M(S("uni-countdown"),X),O=T,z=M(S("XtxGuess"),j),H=x("PageSkeleton"),R=_,$=M(S("uni-popup"),B);return e(),y(m,null,[i(b,{class:"navbar",style:l({paddingTop:(null==(f=h(U))?void 0:f.top)+"px"})},{default:a((()=>[i(b,{class:"wrap"},{default:a((()=>[h(J).length>1?(e(),s(p,{key:0,"open-type":"navigateBack",class:"back icon-left"})):(e(),s(p,{key:1,url:"/pages/index/index","open-type":"switchTab",class:"back icon-home"})),i(b,{class:"title"},{default:a((()=>[o("订单详情")])),_:1})])),_:1})])),_:1},8,["style"]),i(R,{"scroll-y":"",class:"viewport",id:"scroller",onScrolltolower:h(A)},{default:a((()=>{var t,r,d;return[Q.value?(e(),y(m,{key:0},[i(b,{class:"overview",style:l({paddingTop:(null==(t=h(U))?void 0:t.top)+20+"px"})},{default:a((()=>{var t;return[(null==(t=Q.value)?void 0:t.orderState)===L[1].id?(e(),y(m,{key:0},[i(b,{class:"status icon-clock"},{default:a((()=>[o("等待付款")])),_:1}),i(b,{class:"tips"},{default:a((()=>[i(D,{class:"money"},{default:a((()=>[o("应付金额: ¥ "+n(Q.value.payMoney.toFixed(2)),1)])),_:1}),i(D,{class:"time"},{default:a((()=>[o("支付剩余")])),_:1}),i(I,{second:Q.value.countdown,onTimeup:V,color:"#fff","show-day":!1,"show-colon":!1,"splitor-color":"#fff"},null,8,["second"])])),_:1}),i(b,{class:"button",onClick:W},{default:a((()=>[o("去支付")])),_:1})],64)):(e(),y(m,{key:1},[i(b,{class:"status"},{default:a((()=>{var t;return[o(n(L[null==(t=Q.value)?void 0:t.orderState].text),1)]})),_:1}),i(b,{class:"button-group"},{default:a((()=>[i(p,{class:"button",url:`/pagesOrder/create/create?orderId=${F.id}`,"hover-class":"none"},{default:a((()=>[o(" 再次购买 ")])),_:1},8,["url"]),h(false)&&Q.value.orderState==L[2].id?(e(),s(b,{key:0,class:"button",onClick:Y},{default:a((()=>[o(" 模拟发货 ")])),_:1})):u("",!0)])),_:1})],64))]})),_:1},8,["style"]),i(b,{class:"shipment"},{default:a((()=>[(e(!0),y(m,null,v(tt.value,(t=>(e(),s(b,{key:t.id,class:"item"},{default:a((()=>[i(b,{class:"message"},{default:a((()=>[o(n(t.text),1)])),_:2},1024),i(b,{class:"date"},{default:a((()=>[o(n(t.time),1)])),_:2},1024)])),_:2},1024)))),128)),i(b,{class:"locate"},{default:a((()=>[i(b,{class:"user"},{default:a((()=>[o(n(Q.value.receiverContact)+" "+n(Q.value.receiverMobile),1)])),_:1}),i(b,{class:"address"},{default:a((()=>[o(n(Q.value.receiverAddress),1)])),_:1})])),_:1})])),_:1}),i(b,{class:"goods"},{default:a((()=>[i(b,{class:"item"},{default:a((()=>[(e(!0),y(m,null,v(Q.value.skus,(t=>(e(),s(p,{class:"navigator",key:t.id,url:`/pages/goods/goods?id=${t.spuId}`,"hover-class":"none"},{default:a((()=>[i(O,{class:"cover",src:t.image},null,8,["src"]),i(b,{class:"meta"},{default:a((()=>[i(b,{class:"name ellipsis"},{default:a((()=>[o(n(t.name),1)])),_:2},1024),i(b,{class:"type"},{default:a((()=>[o(n(t.attrsText),1)])),_:2},1024),i(b,{class:"price"},{default:a((()=>[i(b,{class:"actual"},{default:a((()=>[i(D,{class:"symbol"},{default:a((()=>[o("¥")])),_:1}),i(D,null,{default:a((()=>[o(n(t.curPrice.toFixed(2)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),i(b,{class:"quantity"},{default:a((()=>[o("x"+n(t.quantity),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["url"])))),128)),Q.value.orderState==L[4].id?(e(),s(b,{key:0,class:"action"},{default:a((()=>[i(b,{class:"button primary"},{default:a((()=>[o("申请售后")])),_:1}),i(p,{url:"",class:"button"},{default:a((()=>[o(" 去评价 ")])),_:1})])),_:1})):u("",!0)])),_:1}),i(b,{class:"total"},{default:a((()=>[i(b,{class:"row"},{default:a((()=>[i(b,{class:"text"},{default:a((()=>[o("商品总价: ")])),_:1}),i(b,{class:"symbol"},{default:a((()=>[o(n(Q.value.totalMoney.toFixed(2)),1)])),_:1})])),_:1}),i(b,{class:"row"},{default:a((()=>[i(b,{class:"text"},{default:a((()=>[o("运费: ")])),_:1}),i(b,{class:"symbol"},{default:a((()=>[o(n(Q.value.postFee.toFixed(2)),1)])),_:1})])),_:1}),i(b,{class:"row"},{default:a((()=>[i(b,{class:"text"},{default:a((()=>[o("应付金额: ")])),_:1}),i(b,{class:"symbol primary"},{default:a((()=>[o(n(Q.value.payMoney.toFixed(2)),1)])),_:1})])),_:1})])),_:1})])),_:1}),i(b,{class:"detail"},{default:a((()=>[i(b,{class:"title"},{default:a((()=>[o("订单信息")])),_:1}),i(b,{class:"row"},{default:a((()=>[i(b,{class:"item"},{default:a((()=>[o(" 订单编号: "+n(F.id)+" ",1),i(D,{class:"copy",onClick:c[0]||(c[0]=t=>{return e=F.id,void w({data:e});var e})},{default:a((()=>[o("复制")])),_:1})])),_:1}),i(b,{class:"item"},{default:a((()=>[o(n(Q.value.createTime),1)])),_:1})])),_:1})])),_:1}),i(z,{ref_key:"guessRef",ref:q},null,512),i(b,{class:"toolbar-height",style:l({paddingBottom:(null==(r=h(U))?void 0:r.bottom)+"px"})},null,8,["style"]),i(b,{class:"toolbar",style:l({paddingBottom:(null==(d=h(U))?void 0:d.bottom)+"px"})},{default:a((()=>[Q.value.orderState==L[1].id?(e(),y(m,{key:0},[i(b,{class:"button primary",onClick:W},{default:a((()=>[o(" 去支付 ")])),_:1}),i(b,{class:"button",onClick:c[1]||(c[1]=t=>{var e,s;return null==(s=null==(e=G.value)?void 0:e.open)?void 0:s.call(e)})},{default:a((()=>[o(" 取消订单 ")])),_:1})],64)):(e(),y(m,{key:1},[i(p,{class:"button secondary",url:`/pagesOrder/create/create?orderId=${F.id}`,"hover-class":"none"},{default:a((()=>[o(" 再次购买 ")])),_:1},8,["url"]),Q.value.orderState==L[3].id?(e(),s(b,{key:0,class:"button primary",onClick:Z},{default:a((()=>[o(" 确认收货 ")])),_:1})):u("",!0),Q.value.orderState==L[4].id?(e(),s(b,{key:1,class:"button"},{default:a((()=>[o(" 去评价 ")])),_:1})):u("",!0),Q.value.orderState>=L[4].id?(e(),s(b,{key:2,class:"button delete",onClick:st},{default:a((()=>[o(" 删除订单 ")])),_:1})):u("",!0)],64))])),_:1},8,["style"])],64)):(e(),s(H,{key:1}))]})),_:1},8,["onScrolltolower"]),i($,{ref_key:"popup",ref:G,type:"bottom","background-color":"#fff"},{default:a((()=>[i(b,{class:"popup-root"},{default:a((()=>[i(b,{class:"title"},{default:a((()=>[o("订单取消")])),_:1}),i(b,{class:"description"},{default:a((()=>[i(b,{class:"tips"},{default:a((()=>[o("请选择取消订单的原因：")])),_:1}),(e(!0),y(m,null,v(P.value,(t=>(e(),s(b,{class:"cell",key:t,onClick:e=>E.value=t},{default:a((()=>[i(D,{class:"text"},{default:a((()=>[o(n(t),1)])),_:2},1024),i(D,{class:C(["icon",{checked:t===E.value}])},null,8,["class"])])),_:2},1032,["onClick"])))),128))])),_:1}),i(b,{class:"footer"},{default:a((()=>[i(b,{class:"button",onClick:c[2]||(c[2]=t=>{var e,s;return null==(s=null==(e=G.value)?void 0:e.close)?void 0:s.call(e)})},{default:a((()=>[o("取消")])),_:1}),i(b,{class:"button primary",onClick:c[3]||(c[3]=t=>(async()=>{await N(F.id,{cancelReason:E.value}),g({url:"/pagesOrder/list/list"})})())},{default:a((()=>[o("确认")])),_:1})])),_:1})])),_:1})])),_:1},512)],64)}}},[["__scopeId","data-v-3bc42d97"]]);export{A as default};
