import{y as e,G as t,n as s,o as l,c as a,w as o,a as r,s as c,q as u,b as n,t as d,D as i,E as p,h as f,F as m,r as k,H as g,J as y,e as b,i as C,d as h,m as _,z as v,S,k as N,A as x,j as I,g as w,l as A,v as B,f as T}from"./index-af18ee11.js";import{_ as F,b as V}from"./cart.5864466a.js";import{r as L,o as O}from"./uni-app.es.6b8c51ac.js";import{_ as j}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as G}from"./uni-popup.665f5863.js";import{h as D}from"./http.84d8a07a.js";var E,J={};const P=j({name:"vk-data-goods-sku-popup",emits:["update:modelValue","input","update-goods","open","close","add-cart","buy-now","cart","buy","num-change"],props:{value:{type:Boolean,default:!1},modelValue:{type:Boolean,default:!1},goodsId:{type:String,default:""},action:{type:String,default:""},noStockText:{type:String,default:"该商品已抢完"},stockText:{type:String,default:"库存"},goodsIdName:{type:String,default:"_id"},skuIdName:{type:String,default:"_id"},skuListName:{type:String,default:"sku_list"},specListName:{type:String,default:"spec_list"},stockName:{type:String,default:"stock"},skuArrName:{type:String,default:"sku_name_arr"},defaultSingleSkuName:{type:String,default:"默认"},mode:{type:Number,default:1},maskCloseAble:{type:Boolean,default:!0},borderRadius:{type:[String,Number],default:0},goodsThumbName:{type:[String],default:"goods_thumb"},goodsThumbBackgroundColor:{type:String,default:"transparent"},minBuyNum:{type:[Number,String],default:1},maxBuyNum:{type:[Number,String],default:1e5},stepBuyNum:{type:[Number,String],default:1},stepStrictly:{type:Boolean,default:!1},customAction:{type:[Function],default:null},localdata:{type:Object},priceColor:{type:String},buyNowText:{type:String,default:"立即购买"},buyNowColor:{type:String},buyNowBackgroundColor:{type:String},addCartText:{type:String,default:"加入购物车"},addCartColor:{type:String},addCartBackgroundColor:{type:String},disableStyle:{type:Object,default:null},activedStyle:{type:Object,default:null},btnStyle:{type:Object,default:null},showClose:{type:Boolean,default:!0},closeImage:{type:String,default:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqCAYAAADFw8lbAAAEyUlEQVR42sSZeWwNURTGp4OqtBo7sSXELragdkpQsRRJ1Zr4hyJiJ9YgxNIg1qANiT+E1i5IY0kVVWtQEbuEKLFGUSH27/ANN5PXmTvzupzkl/tm8t6b7517lnvvC0lKSjJ8WmnQAUSDFqABqALKgl8gD7wE90E2SAeXwFf1SxISErQeVtKHwCgwFsSDSIf3hYFKoCkYDBaDdyAViHdueHmoF6FtwDLQ23b/E7gM7oIcejIERIDaoBFoC8qA8mA8SQNz6W1XC9GY+nCQCCYAk/c+gF0gBZwH312+IxR0BCPBUIaH2A+wHsxHCHxx+gLT5QGN6a2JfG8uvVCDws9oiDQYlxkMGfHyQvARlADTwcXk5OT6foV2kS8ATXidymlcyen1a/Jjl9IJh3hPkjELYqO8Cu0KjjNZvtETw5jFBWXPmGSTGQKSeOn5iQ0kVLL0CINfPNcPbDMKyRCbGzEMBJ+ZD8cChYFdqGTqfsWT8otPGoVsEHsMwxDFs3shNsxJ6BrQ0Po8OGUUkVHsNCVml+cntB1jUWwn2GEUsTEMrASbDK+2CCQ0kYX6nfLLisMmKqUr0S60M+jG10vAm+JSCa8+x7CKlzHwaktV6DiObzUzPJIxFO1BQ12wGtTReO9GetVgY/kjNJzZbcWmTjHfxw51AsRqvL8eOAtmsJuFu3g1l+1ZLB5eDTVZ3K0P7tL0TkWOpSg61kVkBtuuNRthGs+wtJST5aQI7cEbkkRXNYVKgX6kIdYuUhYzMQwxN8tiExCLFqHNeSF9/aem0BzGp5PYQCJ7c/Gsk1RfuSD6U1dNpcDf9ZigTmKbMRZ9iVTsHscGJluW2FMf1SSQWGnBmaB6kCJVTVVNJZE++Cx9drEllS1KMCINpURFmEbBWA63Fz9s95cGIdJgp/zXmT4pZcOvSUzuZttTbblmnc3PIjjmidDXvKgdhMh0JdbzuCjWrbNOVovjS5P7bkPJ/mBESkz2BO0166ybNeJ431S2q+01NntuIq3E0amzjiZtk9tssWyTDzO4525bACK9NAUn68TtkNhpEXpOSagRml+S6iLSSeweHv242Qhl13rRyvoDvDlKyTQny/ZQJ+1iH7vVbEx7OR5UiKVIO7VicgvHCtwrudloMIV7/0uadVYW57O4Wvvi8v4pymlKkrpwvsDeLLZAY2pkwbAB3PSQfC+4cH7l4k1ZH8zkZRq8ecO+Z5rN40JJqnXFuGfaxPCTLjcn0OZOpnArXw8HY4paIbw5CcMgXq6HN2/mt6+XGLrN15tBryIUGavMpCTrfKcDCKkAceA9S8nhAOehhSUyhXpkBxxnP4YM1InugP7cBkjBPcqVUWFYCEROxXiQz5JlXV+IfKh7mpfJac+lZ6V87QXVClBkTc7YWsWTPSDyitfzUTlJlj8TbvE6jluDOdwZ+jX57GLO3ADeuyZrDYi86vV81FD2UVGsmT+5Zl0BnkhoseOEaogL46pqO4v/IqUEyalIR4h85BgjHv6+aUWRMbb7EstX6O0cpT1Gco0ry8fWygLDMjmDnQeBt3Qe7uVfkeugDwVLcsVzGsuwLXbV+I63XNAkG5r/hvgRqgqWs6pJPKrsbvz/Q6yyun0w/h6lP+BnzrCpfPMT2L8FGAA7k1GZ/vnaqAAAAABJRU5ErkJggg=="},hideStock:{type:Boolean,default:!1},theme:{type:String,default:"default"},actionTips:{type:String,default:"请求中..."},defaultSelect:{type:Object},useCache:{type:Boolean,default:!0},defaultGoods:{type:Object},amountType:{type:Number,default:1},selectedInit:{type:Boolean,default:!1},safeAreaInsetBottom:{type:Boolean,default:!0},zIndex:{type:[Number,String],default:990}},data(){return{complete:!1,goodsInfo:{},isShow:!1,initKey:!0,shopItemInfo:{},selectArr:[],subIndex:[],selectShop:{},selectNum:this.minBuyNum||1,outFoStock:!1,openTime:0,themeColor:{default:{priceColor:"rgb(254, 86, 10)",buyNowColor:"#ffffff",buyNowBackgroundColor:"rgb(254, 86, 10)",addCartColor:"#ffffff",addCartBackgroundColor:"rgb(255, 148, 2)",btnStyle:{color:"#333333",borderColor:"#f4f4f4",backgroundColor:"#ffffff"},activedStyle:{color:"rgb(254, 86, 10)",borderColor:"rgb(254, 86, 10)",backgroundColor:"rgba(254,86,10,0.1)"},disableStyle:{color:"#c3c3c3",borderColor:"#f6f6f6",backgroundColor:"#f6f6f6"}},"red-black":{priceColor:"rgb(255, 68, 68)",buyNowColor:"#ffffff",buyNowBackgroundColor:"rgb(255, 68, 68)",addCartColor:"#ffffff",addCartBackgroundColor:"rgb(85, 85, 85)",activedStyle:{color:"rgb(255, 68, 68)",borderColor:"rgb(255, 68, 68)",backgroundColor:"rgba(255,68,68,0.1)"}},"black-white":{priceColor:"rgb(47, 47, 52)",buyNowColor:"#ffffff",buyNowBackgroundColor:"rgb(47, 47, 52)",addCartColor:"rgb(47, 47, 52)",addCartBackgroundColor:"rgb(235, 236, 242)",activedStyle:{color:"rgb(47, 47, 52)",borderColor:"rgba(47,47,52,0.12)",backgroundColor:"rgba(47,47,52,0.12)"}},coffee:{priceColor:"rgb(195, 167, 105)",buyNowColor:"#ffffff",buyNowBackgroundColor:"rgb(195, 167, 105)",addCartColor:"rgb(195, 167, 105)",addCartBackgroundColor:"rgb(243, 238, 225)",activedStyle:{color:"rgb(195, 167, 105)",borderColor:"rgb(195, 167, 105)",backgroundColor:"rgba(195, 167, 105,0.1)"}},green:{priceColor:"rgb(99, 190, 114)",buyNowColor:"#ffffff",buyNowBackgroundColor:"rgb(99, 190, 114)",addCartColor:"rgb(99, 190, 114)",addCartBackgroundColor:"rgb(225, 244, 227)",activedStyle:{color:"rgb(99, 190, 114)",borderColor:"rgb(99, 190, 114)",backgroundColor:"rgba(99, 190, 114,0.1)"}}}}},created(){let e=this;E=e.vk,e.valueCom&&e.open()},mounted(){},methods:{init(e){let t=this;t.selectArr=[],t.subIndex=[],t.selectShop={},t.selectNum=t.minBuyNum||1,t.outFoStock=!1,t.shopItemInfo={};let s=t.specListName;t.goodsInfo[s].map((e=>{t.selectArr.push(""),t.subIndex.push(-1)})),t.checkItem(),t.checkInpath(-1),e||t.autoClickSku()},findGoodsInfo(e={}){let t=this,{useCache:s}=e;if(void 0===E)return t.toast("custom-action必须是function","none"),!1;let{actionTips:l}=t,a="",o=!1;"custom"!==l?a=s?"":"请求中...":o=!s,E.callFunction({url:t.action,title:a,loading:o,data:{goods_id:t.goodsId},success(e){t.updateGoodsInfo(e.goodsInfo),J[t.goodsId]=e.goodsInfo,t.$emit("update-goods",e.goodsInfo)},fail(){t.updateValue(!1)}})},updateValue(e){let t=this;e?(t.$emit("open",!0),t.$emit("input",!0),t.$emit("update:modelValue",!0)):(t.$emit("input",!1),t.$emit("close","close"),t.$emit("update:modelValue",!1))},updateGoodsInfo(e){let t=this,{skuListName:s}=t;"{}"===JSON.stringify(t.goodsInfo)||t.goodsInfo[t.goodsIdName]!==e[t.goodsIdName]?(t.goodsInfo=e,t.initKey=!0):t.goodsInfo[s]=e[s],t.initKey&&(t.initKey=!1,t.init());let l=t.getListItem(t.goodsInfo[s],t.skuIdName,t.selectShop[t.skuIdName]);Object.assign(t.selectShop,l),t.defaultSelectSku(),t.complete=!0},async open(){let e=this;e.openTime=(new Date).getTime();let t=!0;e.skuListName;let s=!1,l=J[e.goodsId];if(l&&e.useCache?(s=!0,e.updateGoodsInfo(l)):e.complete=!1,e.customAction&&"function"==typeof e.customAction){try{l=await e.customAction({useCache:s,goodsId:e.goodsId,goodsInfo:l,close:function(){setTimeout((function(){e.close()}),500)}}).catch((t=>{setTimeout((function(){e.close()}),500)}))}catch(a){let{message:t=""}=a;if(t.indexOf(".catch is not a function")>-1)return e.toast("custom-action必须返回一个Promise","none"),setTimeout((function(){e.close()}),500),!1}if(J[e.goodsId]=l,!l||"object"!=typeof l||"{}"==JSON.stringify(l))return e.toast("未获取到商品信息","none"),e.$emit("input",!1),!1;t=!1,e.updateGoodsInfo(l),e.updateValue(!0)}else if(void 0!==e.localdata&&null!==e.localdata){if(l=e.localdata,!l||"object"!=typeof l||"{}"==JSON.stringify(l))return e.toast("未获取到商品信息","none"),e.$emit("input",!1),!1;t=!1,e.updateGoodsInfo(l),e.updateValue(!0)}else t&&e.findGoodsInfo({useCache:s})},close(e){let t=this;if((new Date).getTime()-t.openTime<400)return!1;"mask"==e?!1!==t.maskCloseAble&&(t.$emit("input",!1),t.$emit("close","mask"),t.$emit("update:modelValue",!1)):(t.$emit("input",!1),t.$emit("close","close"),t.$emit("update:modelValue",!1))},moveHandle(){},skuClick(e,t,s){let l=this;e.ishow&&(l.selectArr[t]!=e.name?(l.$set(l.selectArr,t,e.name),l.$set(l.subIndex,t,s)):(l.$set(l.selectArr,t,""),l.$set(l.subIndex,t,-1)),l.checkInpath(t),l.checkSelectShop())},checkSelectShop(){let e=this;if(e.selectArr.every((e=>""!=e))){e.selectShop=e.shopItemInfo[e.getArrayToSting(e.selectArr)];let t=e.selectShop[e.stockName];void 0!==t&&e.selectNum>t&&(e.selectNum=t),e.selectNum>e.maxBuyNum&&(e.selectNum=e.maxBuyNum),e.selectNum<e.minBuyNum&&(e.selectNum=e.minBuyNum),e.selectedInit&&(e.selectNum=e.minBuyNum||1)}else e.selectShop={}},checkInpath(e){let t=this,s=t.specListName,l=t.goodsInfo[s];for(let a=0,o=l.length;a<o;a++){if(a==e)continue;let s=l[a].list.length;for(let e=0;e<s;e++){if(-1!=t.subIndex[a]&&e==t.subIndex[a])continue;let s=[...t.selectArr];t.$set(s,a,l[a].list[e].name);let o=s.filter((e=>""!==e&&void 0!==e));Object.prototype.hasOwnProperty.call(t.shopItemInfo,t.getArrayToSting(o))?l[a].list[e].ishow=!0:l[a].list[e].ishow=!1}}t.$set(t.goodsInfo,s,l)},checkItem(){let e=this,{stockName:t}=e,s=e.skuListName,l=e.goodsInfo[s],a=[],o=0;l.map(((e,s)=>{e[t]>0&&(a.push(e),o+=e[t])})),o<=0&&(e.outFoStock=!0),a.reduce(((t,s)=>t.concat(s[e.skuArrName].reduce(((t,l)=>t.concat(t.map((t=>(Object.prototype.hasOwnProperty.call(e.shopItemInfo,e.getArrayToSting([...t,l]))||(e.shopItemInfo[e.getArrayToSting([...t,l])]=s),[...t,l]))))),[[]]))),[[]])},getArrayToSting(e){let t="";return e.map(((e,s)=>{e=e.replace(/\./g,"。"),t+=0==s?e:","+e})),t},checkSelectComplete(e={}){let t=this,s=(new Date).getTime();if(t.clickTime&&s-t.clickTime<400)return!1;t.clickTime=s;let{selectShop:l,selectNum:a,stockText:o,stockName:r}=t;return l&&l[t.skuIdName]?a<=0?(t.toast("购买数量必须>0","none"),!1):a>l[r]?(t.toast(o+"不足","none"),!1):void("function"==typeof e.success&&e.success(l)):(t.toast("请先选择对应规格","none"),!1)},addCart(){let e=this;e.checkSelectComplete({success:function(t){t.buy_num=e.selectNum,e.$emit("add-cart",t),e.$emit("cart",t)}})},buyNow(){let e=this;e.checkSelectComplete({success:function(t){t.buy_num=e.selectNum,e.$emit("buy-now",t),e.$emit("buy",t)}})},toast(t,s){e({title:t,icon:s})},getListItem(e,t,s){let l;for(let a in e)if("object"==typeof s){if(JSON.stringify(e[a][t])===JSON.stringify(s)){l=e[a];break}}else if(e[a][t]===s){l=e[a];break}return l},getListIndex(e,t,s){let l=-1;for(let a=0;a<e.length;a++)if(e[a][t]===s){l=a;break}return l},autoClickSku(){let e=this,{stockName:t}=e,s=e.goodsInfo[e.skuListName],l=e.goodsInfo[e.specListName];if(1==l.length){let a=l[0].list;for(let l=0;l<a.length;l++){let o=e.getListItem(s,e.skuArrName,[a[l].name]);if(o&&o[t]>0){e.skuClick(a[l],0,l);break}}}},themeColorFn(e){let t=this,{theme:s,themeColor:l}=t;return t[e]?t[e]:l[s][e]},defaultSelectSku(){let e=this,{defaultSelect:t}=e;t&&t.sku&&t.sku.length>0&&e.selectSku(t)},selectSku(e={}){let t=this,{sku:s,num:l}=e,a=t.goodsInfo[t.specListName];if(s&&a.length===s.length){let e=[],l=!0;for(let o=0;o<s.length;o++){let r=s[o],c=a[o].list,u=o,n=t.getListIndex(c,"name",r);if(-1==n){l=!1;break}e.push({spec:c[n],index1:u,index2:n})}l&&(t.init(!0),e.map((e=>{t.skuClick(e.spec,e.index1,e.index2)})))}l>0&&(t.selectNum=l)},priceFilter(e=0){return"string"==typeof e&&(e=parseFloat(e)),0===this.amountType?e.toFixed(2):(e/100).toFixed(2)},pushGoodsCache(e){let{goodsIdName:t}=this;J[e[t]]=e},stop(){},previewImage(){let{selectShop:e,goodsInfo:s,goodsThumbName:l}=this,a=e.image?e.image:s[l];a&&t({urls:[a]})},getMaxStock(){let e=0,{selectShop:t={},goodsInfo:s={},skuListName:l,stockName:a}=this;if(t[a])e=t[a];else{let t=s[l];if(t&&t.length>0){let s=[];t.map(((e,t)=>{s.push(e[a])})),e=Math.max(...s)}}return e},numChange(e){this.$emit("num-change",e.value)}},computed:{valueCom(){return this.modelValue},maxBuyNumCom(){let e=this.getMaxStock(),t=this.maxBuyNum||1e5;return t>e&&(t=e),t},isManyCom(){let{goodsInfo:e,defaultSingleSkuName:t,specListName:s}=this,l=!0;return e[s]&&1===e[s].length&&1===e[s][0].list.length&&e[s][0].name===t&&(l=!1),l},priceCom(){let e="",t=this,{selectShop:s={},goodsInfo:l={},skuListName:a,skuIdName:o}=t;if(s[o])e=t.priceFilter(s.price);else{let s=l[a];if(s&&s.length>0){let l=[];s.map(((e,t)=>{l.push(e.price)}));let a=t.priceFilter(Math.min(...l)),o=t.priceFilter(Math.max(...l));e=a===o?a+"":`${a} - ${o}`}}return e},stockCom(){let e="",{selectShop:t={},goodsInfo:s={},skuListName:l,stockName:a}=this;if(t[a])e=t[a];else{let t=s[l];if(t&&t.length>0){let s=[];t.map(((e,t)=>{s.push(e[a])}));let l=Math.min(...s),o=Math.max(...s);e=l===o?l:`${l} - ${o}`}}return e}},watch:{valueCom(e,t){e&&this.open()},defaultGoods:{immediate:!0,handler:function(e,t){let s=this,{goodsIdName:l}=s;"object"==typeof e&&e&&e[l]&&!J[e[l]]&&s.pushGoodsCache(e)}}}},[["render",function(e,t,v,S,N,x){const I=b,w=C,A=h,B=L(s("vk-data-input-number-box"),F),T=_;return l(),a(I,{class:c(["vk-data-goods-sku-popup",x.valueCom&&N.complete?"show":"none"]),style:u({zIndex:v.zIndex}),catchtouchmove:"true",onTouchmove:y(x.moveHandle,["stop","prevent"]),onClick:y(x.stop,["stop"])},{default:o((()=>[r(I,{class:"mask",onClick:t[0]||(t[0]=e=>x.close("mask"))}),r(I,{class:c(["layer attr-content",{"safe-area-inset-bottom":v.safeAreaInsetBottom}]),style:u({borderRadius:v.borderRadius+"rpx "+v.borderRadius+"rpx 0 0"})},{default:o((()=>[r(I,{class:"specification-wrapper"},{default:o((()=>[r(T,{class:"specification-wrapper-content","scroll-y":"true"},{default:o((()=>[r(I,{class:"specification-header"},{default:o((()=>[r(I,{class:"specification-left"},{default:o((()=>[r(w,{class:"product-img",src:N.selectShop.image?N.selectShop.image:N.goodsInfo[v.goodsThumbName],style:u({backgroundColor:v.goodsThumbBackgroundColor}),mode:"aspectFill",onClick:x.previewImage},null,8,["src","style","onClick"])])),_:1}),r(I,{class:"specification-right"},{default:o((()=>[r(I,{class:"price-content",style:u({color:x.themeColorFn("priceColor")})},{default:o((()=>[r(A,{class:"sign"},{default:o((()=>[n("¥")])),_:1}),r(A,{class:c(["price",x.priceCom.length>16?"price2":""])},{default:o((()=>[n(d(x.priceCom),1)])),_:1},8,["class"])])),_:1},8,["style"]),v.hideStock?(l(),a(I,{key:1,class:"inventory"})):(l(),a(I,{key:0,class:"inventory"},{default:o((()=>[n(d(v.stockText)+"："+d(x.stockCom),1)])),_:1})),i(r(I,{class:"choose"},{default:o((()=>[n("已选："+d(N.selectArr.join(" ")),1)])),_:1},512),[[p,x.isManyCom]])])),_:1})])),_:1}),r(I,{class:"specification-content"},{default:o((()=>[(l(!0),f(m,null,k(N.goodsInfo[v.specListName],((e,t)=>i((l(),a(I,{class:"specification-item",key:t},{default:o((()=>[r(I,{class:"item-title"},{default:o((()=>[n(d(e.name),1)])),_:2},1024),r(I,{class:"item-wrapper"},{default:o((()=>[(l(!0),f(m,null,k(e.list,((e,s)=>(l(),a(I,{class:c(["item-content",[e.ishow?"":"noactived",N.subIndex[t]==s?"actived":""]]),key:s,style:u([e.ishow?"":x.themeColorFn("disableStyle"),e.ishow?x.themeColorFn("btnStyle"):"",N.subIndex[t]==s?x.themeColorFn("activedStyle"):""]),onClick:l=>x.skuClick(e,t,s)},{default:o((()=>[n(d(e.name),1)])),_:2},1032,["class","style","onClick"])))),128))])),_:2},1024)])),_:2},1024)),[[p,x.isManyCom]]))),128)),r(I,{class:"number-box-view"},{default:o((()=>[r(I,{style:{flex:"1"}},{default:o((()=>[n("数量")])),_:1}),r(I,{style:{flex:"4","text-align":"right"}},{default:o((()=>[r(B,{modelValue:N.selectNum,"onUpdate:modelValue":t[1]||(t[1]=e=>N.selectNum=e),min:v.minBuyNum||1,max:x.maxBuyNumCom,step:v.stepBuyNum||1,"step-strictly":v.stepStrictly,"positive-integer":!0,onChange:x.numChange},null,8,["modelValue","min","max","step","step-strictly","onChange"])])),_:1})])),_:1})])),_:1})])),_:1}),0!=v.showClose?(l(),a(I,{key:0,class:"close",onClick:t[2]||(t[2]=e=>x.close("close"))},{default:o((()=>[r(w,{class:"close-item",src:v.closeImage},null,8,["src"])])),_:1})):g("",!0)])),_:1}),N.outFoStock||4==v.mode?(l(),a(I,{key:0,class:"btn-wrapper"},{default:o((()=>[r(I,{class:"sure",style:{color:"#ffffff","background-color":"#cccccc"}},{default:o((()=>[n(d(v.noStockText),1)])),_:1})])),_:1})):1==v.mode?(l(),a(I,{key:1,class:"btn-wrapper"},{default:o((()=>[r(I,{class:"sure add-cart",style:u([{"border-radius":"38rpx 0rpx 0rpx 38rpx"},{color:x.themeColorFn("addCartColor"),backgroundColor:x.themeColorFn("addCartBackgroundColor")}]),onClick:x.addCart},{default:o((()=>[n(d(v.addCartText),1)])),_:1},8,["style","onClick"]),r(I,{class:"sure",style:u([{"border-radius":"0rpx 38rpx 38rpx 0rpx"},{color:x.themeColorFn("buyNowColor"),backgroundColor:x.themeColorFn("buyNowBackgroundColor")}]),onClick:x.buyNow},{default:o((()=>[n(d(v.buyNowText),1)])),_:1},8,["style","onClick"])])),_:1})):2==v.mode?(l(),a(I,{key:2,class:"btn-wrapper"},{default:o((()=>[r(I,{class:"sure add-cart",style:u({color:x.themeColorFn("addCartColor"),backgroundColor:x.themeColorFn("addCartBackgroundColor")}),onClick:x.addCart},{default:o((()=>[n(d(v.addCartText),1)])),_:1},8,["style","onClick"])])),_:1})):3==v.mode?(l(),a(I,{key:3,class:"btn-wrapper"},{default:o((()=>[r(I,{class:"sure",style:u({color:x.themeColorFn("buyNowColor"),backgroundColor:x.themeColorFn("buyNowBackgroundColor")}),onClick:x.buyNow},{default:o((()=>[n(d(v.buyNowText),1)])),_:1},8,["style","onClick"])])),_:1})):g("",!0)])),_:1},8,["class","style"])])),_:1},8,["style","class","onTouchmove","onClick"])}],["__scopeId","data-v-3dec4758"]]),$=j({__name:"AddressPanel",props:{address:String},emits:["close","index"],setup(e,{emit:t}){const s=e,c=()=>{v({url:"/pagesMember/address/address"})};return(u,i)=>{const p=h,y=b;return l(),a(y,{class:"address-panel"},{default:o((()=>[r(p,{class:"close icon-close"}),r(y,{class:"title"},{default:o((()=>[n("配送至")])),_:1}),r(y,{class:"content"},{default:o((()=>[(l(!0),f(m,null,k(e.address,((e,c)=>(l(),a(y,{class:"item",key:e.id,onClick:e=>(e=>{s.address.forEach((e=>e.selected=!1)),s.address[e].selected=!0,t("close"),t("index",e)})(c)},{default:o((()=>[r(y,{class:"user"},{default:o((()=>[n(d(e.receiver)+" "+d(e.contact),1)])),_:2},1024),r(y,{class:"address"},{default:o((()=>[n(d(e.fullLocation)+" "+d(e.address),1)])),_:2},1024),e.selected?(l(),a(p,{key:0,class:"icon icon-checked"})):(l(),a(p,{key:1,class:"icon icon-ring"}))])),_:2},1032,["onClick"])))),128))])),_:1}),r(y,{class:"footer"},{default:o((()=>[r(y,{class:"button primary",onClick:c},{default:o((()=>[n(" 我的收货地址 ")])),_:1}),g("",!0)])),_:1})])),_:1})}}},[["__scopeId","data-v-ad523057"]]),M=j({__name:"ServicePanel",emits:["close"],setup:(e,{emit:t})=>(e,s)=>{const c=h,u=b;return l(),a(u,{class:"service-panel"},{default:o((()=>[r(c,{class:"close icon-close",onClick:s[0]||(s[0]=e=>t("close"))}),r(u,{class:"title"},{default:o((()=>[n("服务说明")])),_:1}),r(u,{class:"content"},{default:o((()=>[r(u,{class:"item"},{default:o((()=>[r(u,{class:"dt"},{default:o((()=>[n("无忧退货")])),_:1}),r(u,{class:"dd"},{default:o((()=>[n(" 自收到商品之日起30天内，可在线申请无忧退货服务（食品等特殊商品除外） ")])),_:1})])),_:1}),r(u,{class:"item"},{default:o((()=>[r(u,{class:"dt"},{default:o((()=>[n("快速退款")])),_:1}),r(u,{class:"dd"},{default:o((()=>[n(" 收到退货包裹并确认无误后，将在48小时内办理退款， 退款将原路返回，不同银行处理时间不同，预计1-5个工作日到账 ")])),_:1})])),_:1}),r(u,{class:"item"},{default:o((()=>[r(u,{class:"dt"},{default:o((()=>[n("满88元免邮费")])),_:1}),r(u,{class:"dd"},{default:o((()=>[n(" 单笔订单金额(不含运费)满88元可免邮费，不满88元， 单笔订单收取10元邮费 ")])),_:1})])),_:1})])),_:1})])),_:1})}},[["__scopeId","data-v-73c8cc97"]]);const R=j({},[["render",function(e,t){const s=C,c=S,u=N,d=h,i=b,p=_,f=x,m=I;return l(),a(i,{class:"sk-container"},{default:o((()=>[r(p,{"scroll-y":"true",class:"viewport viewport","enable-back-to-top":"true"},{default:o((()=>[r(i,{class:"goods goods"},{default:o((()=>[r(i,{class:"preview preview"},{default:o((()=>[r(u,{circular:"true",current:"0",autoplay:"false"},{default:o((()=>[r(c,{style:{position:"absolute",width:"100%",height:"100%",transform:"translate(0%, 0px) translateZ(0px)"}},{default:o((()=>[r(s,{mode:"aspectFill",class:"sk-image"})])),_:1})])),_:1}),r(i,{class:"indicator indicator"},{default:o((()=>[r(d,{class:"current sk-transparent sk-opacity"},{default:o((()=>[n("1")])),_:1}),r(d,{class:"split sk-transparent sk-opacity"},{default:o((()=>[n("/")])),_:1}),r(d,{class:"total sk-transparent sk-opacity"},{default:o((()=>[n("5")])),_:1})])),_:1})])),_:1}),r(i,{class:"meta meta"},{default:o((()=>[r(i,{class:"price price"},{default:o((()=>[r(d,{class:"symbol sk-transparent sk-opacity"},{default:o((()=>[n("¥")])),_:1}),r(d,{class:"number sk-transparent sk-text-14-2857-810 sk-text"},{default:o((()=>[n("59.00")])),_:1})])),_:1}),r(i,{class:"name ellipsis sk-transparent sk-text-14-2857-29 sk-text"},{default:o((()=>[n("办公居家必备，3A3U智能插线板")])),_:1}),r(i,{class:"desc sk-transparent sk-text-0-0000-49 sk-text"},{default:o((()=>[n("高颜值插线板，办公居家必备app")])),_:1})])),_:1}),r(i,{class:"action action"},{default:o((()=>[r(i,{class:"item arrow sk-pseudo sk-pseudo-circle"},{default:o((()=>[r(d,{class:"label sk-transparent sk-text-14-2857-695 sk-text"},{default:o((()=>[n("选择")])),_:1}),r(d,{class:"text ellipsis sk-transparent sk-text-14-2857-798 sk-text"},{default:o((()=>[n(" 请选择商品规格 ")])),_:1})])),_:1}),r(i,{class:"item arrow sk-pseudo sk-pseudo-circle"},{default:o((()=>[r(d,{class:"label sk-transparent sk-text-14-2857-768 sk-text"},{default:o((()=>[n("送至")])),_:1}),r(d,{class:"text ellipsis sk-transparent sk-text-14-2857-874 sk-text"},{default:o((()=>[n(" 请选择收获地址 ")])),_:1})])),_:1}),r(i,{class:"item arrow sk-pseudo sk-pseudo-circle"},{default:o((()=>[r(d,{class:"label sk-transparent sk-text-14-2857-66 sk-text"},{default:o((()=>[n("服务")])),_:1}),r(d,{class:"text ellipsis sk-transparent sk-text-14-2857-126 sk-text"},{default:o((()=>[n(" 无忧退 快速退款 免费包邮 ")])),_:1})])),_:1})])),_:1})])),_:1}),r(i,{class:"detail detail panel panel"},{default:o((()=>[r(i,{class:"title title"},{default:o((()=>[r(d,{class:"sk-transparent sk-text-0-0000-636 sk-text"},{default:o((()=>[n("详情")])),_:1})])),_:1}),r(i,{class:"content content"},{default:o((()=>[r(i,{class:"properties properties"},{default:o((()=>[r(i,{class:"item item"},{default:o((()=>[r(d,{class:"label sk-transparent sk-text-25-0000-32 sk-text"},{default:o((()=>[n("适用环境")])),_:1}),r(d,{class:"value sk-transparent sk-text-25-0000-196 sk-text"},{default:o((()=>[n("家用")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),r(i,{class:"toolbar toolbar",style:{"padding-bottom":"34px"}},{default:o((()=>[r(i,{class:"icons icons"},{default:o((()=>[r(f,{class:"icons-button sk-transparent sk-button sk-pseudo sk-pseudo-circle"},{default:o((()=>[r(d,{class:"icon-heart sk-pseudo sk-pseudo-circle"}),n("收藏 ")])),_:1}),r(f,{class:"icons-button sk-transparent sk-button sk-pseudo sk-pseudo-circle","open-type":"contact"},{default:o((()=>[r(d,{class:"icon-handset sk-pseudo sk-pseudo-circle"}),n("客服 ")])),_:1}),r(m,{class:"icons-button sk-transparent","open-type":"switchTab"},{default:o((()=>[r(d,{class:"icon-cart sk-pseudo sk-pseudo-circle"}),n("购物车 ")])),_:1})])),_:1}),r(i,{class:"buttons buttons"},{default:o((()=>[r(i,{class:"addcart sk-transparent sk-text-32-9268-738 sk-text",style:{"background-position-x":"50%"}},{default:o((()=>[n(" 加入购物车 ")])),_:1}),r(i,{class:"buynow sk-transparent sk-text-32-9268-211 sk-text",style:{"background-position-x":"50%"}},{default:o((()=>[n(" 立即购买 ")])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-477d0bc8"]]),U=j({__name:"goods",props:{id:{type:String,default:""}},setup(c){const g=c,{safeAreaInsets:y}=w(),F=A([]),j=async()=>{const e=await(t=g.id,D({method:"GET",url:"/goods",data:{id:t}}));var t;F.value=e.result,Y.value={_id:e.result.id,name:e.result.name,goods_thumb:e.result.mainPictures[0],spec_list:e.result.specs.map((e=>({name:e.name,list:e.values}))),sku_list:e.result.skus.map((t=>({_id:t.id,goods_id:e.result.id,goods_name:e.result.name,image:t.picture,price:100*t.price,stock:t.inventory,sku_name_arr:t.specs.map((e=>e.valueName))})))}},E=A(!1);O((async()=>{await j(),E.value=!0}));const J=A(0),U=e=>{J.value=e.detail.current},K=A(),Q=A(),z=e=>{Q.value=e,K.value.open()},H=A(""),Z=A(""),X=e=>{H.value=F.value.userAddresses[e].fullLocation+" "+F.value.userAddresses[e].address,Z.value=F.value.userAddresses[e].id},q=A(!1),Y=A({}),W=A(1),ee=e=>{q.value=!0,W.value=e},te=A(),se=B((()=>{var e,t;return(null==(t=null==(e=te.value)?void 0:e.selectArr)?void 0:t.join(" ").trim())||"请选择商品规格"})),le=async t=>{await V({skuId:t._id,count:t.buy_num}),e({title:"添加成功"}),setTimeout((()=>{q.value=!1}),500)},ae=e=>{console.log(Z.value),console.log(e),v({url:`/pagesOrder/create/create?skuId=${e._id}&count=${e.buy_num}&addressId=${Z.value}`})};return(e,c)=>{var g;const v=L(s("vk-data-goods-sku-popup"),P),w=C,A=S,B=N,V=h,O=b,j=I,D=_,Z=x,oe=L(s("uni-popup"),G);return l(),f(m,null,[r(v,{modelValue:q.value,"onUpdate:modelValue":c[0]||(c[0]=e=>q.value=e),localdata:Y.value,mode:W.value,"add-cart-background-color":"#FFA868","buy-now-background-color":"#27BA9B",ref_key:"skuPopupRef",ref:te,"actived-style":{color:"#27BA9B",borderColor:"#27BA9B",backgroundColor:"#E9F8F5"},onBuyNow:ae,onAddCart:le},null,8,["modelValue","localdata","mode"]),E.value?(l(),a(D,{key:0,"scroll-y":"",class:"viewport"},{default:o((()=>[r(O,{class:"goods"},{default:o((()=>[r(O,{class:"preview"},{default:o((()=>[r(B,{circular:"",onChange:U},{default:o((()=>{var e;return[(l(!0),f(m,null,k(null==(e=F.value)?void 0:e.mainPictures,((e,s)=>(l(),a(A,{key:e},{default:o((()=>[r(w,{mode:"aspectFill",src:e,onClick:s=>{t({current:e,urls:F.value.mainPictures})}},null,8,["src","onClick"])])),_:2},1024)))),128))]})),_:1}),r(O,{class:"indicator"},{default:o((()=>[r(V,{class:"current"},{default:o((()=>[n(d(J.value+1),1)])),_:1}),r(V,{class:"split"},{default:o((()=>[n("/")])),_:1}),r(V,{class:"total"},{default:o((()=>{var e,t;return[n(d(null==(t=null==(e=F.value)?void 0:e.mainPictures)?void 0:t.length),1)]})),_:1})])),_:1})])),_:1}),r(O,{class:"meta"},{default:o((()=>[r(O,{class:"price"},{default:o((()=>[r(V,{class:"symbol"},{default:o((()=>[n("¥")])),_:1}),r(V,{class:"number"},{default:o((()=>[n(d(F.value.price),1)])),_:1})])),_:1}),r(O,{class:"name ellipsis"},{default:o((()=>[n(d(F.value.name),1)])),_:1}),r(O,{class:"desc"},{default:o((()=>[n(d(F.value.desc),1)])),_:1})])),_:1}),r(O,{class:"action"},{default:o((()=>[r(O,{class:"item arrow"},{default:o((()=>[r(V,{class:"label"},{default:o((()=>[n("选择")])),_:1}),r(V,{class:"text ellipsis",onClick:c[1]||(c[1]=e=>ee(1))},{default:o((()=>[n(d(T(se)),1)])),_:1})])),_:1}),r(O,{class:"item arrow",onClick:c[2]||(c[2]=e=>z("address"))},{default:o((()=>[r(V,{class:"label"},{default:o((()=>[n("送至")])),_:1}),H.value?(l(),a(V,{key:0,class:"text ellipsis"},{default:o((()=>[n(d(H.value),1)])),_:1})):(l(),a(V,{key:1,class:"text ellipsis"},{default:o((()=>[n(" 请选择收货地址 ")])),_:1}))])),_:1}),r(O,{class:"item arrow",onClick:c[3]||(c[3]=e=>z("service"))},{default:o((()=>[r(V,{class:"label"},{default:o((()=>[n("服务")])),_:1}),r(V,{class:"text ellipsis"},{default:o((()=>[n(" 无忧退 快速退款 免费包邮 ")])),_:1})])),_:1})])),_:1})])),_:1}),r(O,{class:"detail panel"},{default:o((()=>[r(O,{class:"title"},{default:o((()=>[r(V,null,{default:o((()=>[n("详情")])),_:1})])),_:1}),r(O,{class:"content"},{default:o((()=>{var e;return[r(O,{class:"properties"},{default:o((()=>{var e;return[(l(!0),f(m,null,k(null==(e=F.value.details)?void 0:e.properties,(e=>(l(),a(O,{class:"item",key:e.name},{default:o((()=>[r(V,{class:"label"},{default:o((()=>[n(d(e.name),1)])),_:2},1024),r(V,{class:"value"},{default:o((()=>[n(d(e.value),1)])),_:2},1024)])),_:2},1024)))),128))]})),_:1}),(l(!0),f(m,null,k(null==(e=F.value.details)?void 0:e.pictures,(e=>(l(),a(w,{mode:"widthFix",key:e,src:e},null,8,["src"])))),128))]})),_:1})])),_:1}),r(O,{class:"similar panel"},{default:o((()=>[r(O,{class:"title"},{default:o((()=>[r(V,null,{default:o((()=>[n("同类推荐")])),_:1})])),_:1}),r(O,{class:"content"},{default:o((()=>[(l(!0),f(m,null,k(F.value.similarProducts,(e=>(l(),a(j,{key:e.id,class:"goods","hover-class":"none",url:`/pages/goods/goods?id=${e.id}`},{default:o((()=>[r(w,{class:"image",mode:"aspectFill",src:e.picture},null,8,["src"]),r(O,{class:"name ellipsis"},{default:o((()=>[n(d(e.name),1)])),_:2},1024),r(O,{class:"price"},{default:o((()=>[r(V,{class:"symbol"},{default:o((()=>[n("¥")])),_:1}),r(V,{class:"number"},{default:o((()=>[n(d(e.price),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["url"])))),128))])),_:1})])),_:1})])),_:1})):(l(),a(R,{key:1})),r(O,{class:"toolbar",style:u({paddingBottom:(null==(g=T(y))?void 0:g.bottom)+"px"})},{default:o((()=>[r(O,{class:"icons"},{default:o((()=>[r(Z,{class:"icons-button"},{default:o((()=>[r(V,{class:"icon-heart"}),n("收藏")])),_:1}),r(j,{class:"icons-button",url:"/pages/cart/cart2"},{default:o((()=>[r(V,{class:"icon-cart"}),n("购物车 ")])),_:1})])),_:1}),r(O,{class:"buttons"},{default:o((()=>[r(O,{class:"addcart",onClick:c[4]||(c[4]=e=>ee(2))},{default:o((()=>[n(" 加入购物车 ")])),_:1}),r(O,{class:"buynow",onClick:c[5]||(c[5]=e=>ee(3))},{default:o((()=>[n(" 立即购买 ")])),_:1})])),_:1})])),_:1},8,["style"]),r(oe,{ref_key:"popup",ref:K,type:"bottom",backgroundColor:"#fff"},{default:o((()=>[i(r($,{onClose:c[6]||(c[6]=e=>{var t;return null==(t=K.value)?void 0:t.close()}),onIndex:X,address:F.value.userAddresses},null,8,["address"]),[[p,"address"===Q.value]]),i(r(M,{onClose:c[7]||(c[7]=e=>{var t;return null==(t=K.value)?void 0:t.close()})},null,512),[[p,"service"===Q.value]])])),_:1},512)],64)}}},[["__scopeId","data-v-df338e50"]]);export{U as default};
