import{l as e,g as s,v as a,o as l,h as t,a as d,w as r,q as u,f as o,F as c,e as n,m as i,c as p,b as f,t as v,r as m,s as _,y,$ as g,d as b,j as I,R as x,I as h,i as k}from"./index-af18ee11.js";import{g as A,a as j,b as w,p as F}from"./order.18c49d40.js";import{a as P,o as S}from"./uni-app.es.6b8c51ac.js";import{u as T}from"./address.9a482e8e.js";import{_ as C}from"./_plugin-vue_export-helper.1b428a4d.js";import"./http.84d8a07a.js";const M=C({__name:"create",props:{skuId:{type:String,default:""},count:{type:String,default:""},addressId:{type:String,default:""},orderId:{type:String}},setup(C){const M=C,V=e([]),{safeAreaInsets:$}=s(),q=e(""),B=e([{type:1,text:"时间不限 (周一至周日)"},{type:2,text:"工作日送 (周一至周五)"},{type:3,text:"周末配送 (周六至周日)"}]),D=e(0),L=a((()=>B.value[D.value])),O=e=>{D.value=e.detail.value};console.log(M.orderId);P((()=>(async()=>{if(console.log(M.orderId),M.skuId&&M.count){const e=await A({count:M.count,skuId:M.skuId,addressId:M.addressId});V.value=e.result}else if(M.orderId){const e=await j(M.orderId);V.value=e.result}else{const e=await w();V.value=e.result}})())),S((()=>{R.selectedAddress=void 0}));const R=T(),U=a((()=>{var e,s,a,l,t,d,r;return 1===(null==(s=null==(e=V.value)?void 0:e.userAddresses)?void 0:s.length)?(null==(a=R.selectedAddress)?void 0:a.id)?R.selectedAddress:null==(l=V.value)?void 0:l.userAddresses[0]:(null==(t=R.selectedAddress)?void 0:t.id)?R.selectedAddress:null==(r=null==(d=V.value)?void 0:d.userAddresses)?void 0:r.find((e=>e.isDefault))})),z=async()=>{if(!U.value.id)return y({icon:"none",title:"请选择收货地址"});const e=await F({addressId:U.value.id,buyerMessage:q.value,deliveryTimeType:L.value.type,goods:V.value.goods.map((e=>({count:e.count,skuId:e.skuId}))),payChannel:2,payType:1});g({url:`/pagesOrder/detail/detail?id=${e.result.id}`})};return(e,s)=>{var a;const y=n,g=b,A=I,j=k,w=x,F=h,P=i;return l(),t(c,null,[d(P,{"scroll-y":"",class:"viewport"},{default:r((()=>[o(U)?(l(),p(A,{key:0,class:"shipment","hover-class":"none",url:"/pagesMember/address/address?from=order"},{default:r((()=>[d(y,{class:"user"},{default:r((()=>[f(v(o(U).receiver)+" "+v(o(U).contact),1)])),_:1}),d(y,{class:"address"},{default:r((()=>[f(v(o(U).fullLocation+" "+o(U).address),1)])),_:1}),d(g,{class:"icon icon-right"})])),_:1})):(l(),p(A,{key:1,class:"shipment","hover-class":"none",url:"/pagesMember/address/address?from=order"},{default:r((()=>[d(y,{class:"address"},{default:r((()=>[f(" 请选择收货地址 ")])),_:1}),d(g,{class:"icon icon-right"})])),_:1})),d(y,{class:"goods"},{default:r((()=>[(l(!0),t(c,null,m(V.value.goods,(e=>(l(),p(A,{key:e.id,url:`/pages/goods/goods?id=${e.id}`,class:"item","hover-class":"none"},{default:r((()=>[d(j,{class:"picture",src:e.picture},null,8,["src"]),d(y,{class:"meta"},{default:r((()=>[d(y,{class:"name ellipsis"},{default:r((()=>[f(v(e.name),1)])),_:2},1024),d(y,{class:"attrs"},{default:r((()=>[f(v(e.attrsText),1)])),_:2},1024),d(y,{class:"prices"},{default:r((()=>[d(y,{class:"pay-price symbol"},{default:r((()=>[f(v(e.payPrice),1)])),_:2},1024),d(y,{class:"price symbol"},{default:r((()=>[f(v(e.price),1)])),_:2},1024)])),_:2},1024),d(y,{class:"count"},{default:r((()=>[f(v(e.count),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["url"])))),128))])),_:1}),d(y,{class:"related"},{default:r((()=>[d(y,{class:"item"},{default:r((()=>[d(g,{class:"text"},{default:r((()=>[f("配送时间")])),_:1}),d(w,{range:B.value,"range-key":"text",onChange:O},{default:r((()=>[d(y,{class:"icon-fonts picker"},{default:r((()=>[f(v(o(L).text),1)])),_:1})])),_:1},8,["range"])])),_:1}),d(y,{class:"item"},{default:r((()=>[d(g,{class:"text"},{default:r((()=>[f("订单备注")])),_:1}),d(F,{class:"input","cursor-spacing":30,placeholder:"选填，建议留言前先与商家沟通确认",modelValue:q.value,"onUpdate:modelValue":s[0]||(s[0]=e=>q.value=e)},null,8,["modelValue"])])),_:1})])),_:1}),d(y,{class:"settlement"},{default:r((()=>[d(y,{class:"item"},{default:r((()=>[d(g,{class:"text"},{default:r((()=>[f("商品总价: ")])),_:1}),d(g,{class:"number symbol"},{default:r((()=>{var e,s;return[f(v(null==(s=null==(e=V.value)?void 0:e.summary)?void 0:s.totalPrice.toFixed(2)),1)]})),_:1})])),_:1}),d(y,{class:"item"},{default:r((()=>[d(g,{class:"text"},{default:r((()=>[f("运费: ")])),_:1}),d(g,{class:"number symbol"},{default:r((()=>{var e,s;return[f(v(null==(s=null==(e=V.value)?void 0:e.summary)?void 0:s.postFee.toFixed(2)),1)]})),_:1})])),_:1})])),_:1})])),_:1}),d(y,{class:"toolbar",style:u({paddingBottom:(null==(a=o($))?void 0:a.bottom)+"px"})},{default:r((()=>{var s;return[d(y,{class:"total-pay symbol"},{default:r((()=>[d(g,{class:"number"},{default:r((()=>{var e;return[f(v(null==(e=V.value.summary)?void 0:e.totalPayPrice.toFixed(2)),1)]})),_:1})])),_:1}),d(y,{class:_(["button",{disabled:null==(s=e.selecteAddress)?void 0:s.id}]),onClick:z},{default:r((()=>[f(" 提交订单 ")])),_:1},8,["class"])]})),_:1},8,["style"]),d(y,{class:"toolbar-height"})],64)}}},[["__scopeId","data-v-3138fbd8"]]);export{M as default};
