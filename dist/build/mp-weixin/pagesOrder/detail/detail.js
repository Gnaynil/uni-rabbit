"use strict";const e=require("../../common/vendor.js"),t=require("../../composables/index.js"),r=require("../../services/order.js");if(require("../../utils/http.js"),require("../../stores/index.js"),require("../../stores/modules/member.js"),!Array){(e.resolveComponent("uni-countdown")+e.resolveComponent("XtxGuess")+e.resolveComponent("PageSkeleton")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-countdown/uni-countdown.js")+(()=>"../../components/XtxGuess.js")+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-popup/uni-popup.js"))();const o={__name:"detail",props:{id:String},setup(o){const a=o,{safeAreaInsets:d}=e.index.getSystemInfoSync(),{guessRef:l,onScrolltolower:i}=t.useGuessList(),n=e.ref(),s=e.ref(["商品无货","不想要了","商品信息填错了","地址信息填写错误","商品降价","其它"]),u=e.ref(""),c=getCurrentPages(),v=c.at(-1);e.onReady((()=>{v.animate(".navbar",[{backgroundColor:"transparent"},{backgroundColor:"#f8f8f8"}],1e3,{scrollSource:"#scroller",startScrollOffset:0,endScrollOffset:50,timeRange:1e3}),v.animate(".navbar .title",[{color:"transparent"},{color:"#000"}],1e3,{scrollSource:"#scroller",timeRange:1e3,startScrollOffset:0,endScrollOffset:50}),v.animate(".navbar .back",[{color:"#fff"},{color:"#000"}],1e3,{scrollSource:"#scroller",timeRange:1e3,startScrollOffset:0,endScrollOffset:50})}));const f=[{id:0,text:""},{id:1,text:"待付款"},{id:2,text:"待发货"},{id:3,text:"待收货"},{id:4,text:"待评价"},{id:5,text:"已完成"},{id:6,text:"已取消"}],p=e.ref();e.onLoad((()=>(async()=>{const e=await r.getMemberOrderByIdAPI(a.id);p.value=e.result,[f[3].id,f[4].id,,f[5].id].includes(p.value.orderState)&&w()})()));const m=()=>{p.value.orderState=f[6].id},x=!1,g=async()=>{{const t=await r.getPayWxPayMiniPayAPI({orderId:a.id});e.wx$1.requestPayment(t.result)}e.index.redirectTo({url:`/pagesOrder/payment/payment?id=${a.id}`})},S=async()=>{},y=()=>{e.index.showModal({content:"为保障您的权益，请收到货并确认无误后，再确认收货",success:async e=>{if(console.log(e),e.confirm){const e=await r.putMemberOrderReceiptByIdAPI(a.id);p.value=e.result}}})},b=e.ref([]),w=async()=>{const e=await r.getMemberOrderLogisticsByIdAPI(a.id);b.value=e.result.list},I=()=>{e.index.showModal({content:"是否删除订单",success:async t=>{t.confirm&&(await r.deleteMemberOrderAPI({ids:[a.id]}),e.index.redirectTo({url:"/pagesOrder/list/list"}))}})};return(t,o)=>{var v,w,O,P,M,C,j;return e.e({a:e.unref(c).length>1},(e.unref(c).length,{}),{b:(null==(v=e.unref(d))?void 0:v.top)+"px",c:p.value},p.value?e.e({d:(null==(w=p.value)?void 0:w.orderState)===f[1].id},(null==(O=p.value)?void 0:O.orderState)===f[1].id?{e:e.t(p.value.payMoney.toFixed(2)),f:e.o(m),g:e.p({second:p.value.countdown,color:"#fff","show-day":!1,"show-colon":!1,"splitor-color":"#fff"}),h:e.o(g)}:e.e({i:e.t(f[null==(P=p.value)?void 0:P.orderState].text),j:`/pagesOrder/create/create?orderId=${a.id}`,k:e.unref(x)&&p.value.orderState==f[2].id},e.unref(x)&&p.value.orderState==f[2].id?{l:e.o(S)}:{}),{m:(null==(M=e.unref(d))?void 0:M.top)+20+"px",n:e.f(b.value,((t,r,o)=>({a:e.t(t.text),b:e.t(t.time),c:t.id}))),o:e.t(p.value.receiverContact),p:e.t(p.value.receiverMobile),q:e.t(p.value.receiverAddress),r:e.f(p.value.skus,((t,r,o)=>({a:t.image,b:e.t(t.name),c:e.t(t.attrsText),d:e.t(t.curPrice.toFixed(2)),e:e.t(t.quantity),f:t.id,g:`/pages/goods/goods?id=${t.spuId}`}))),s:p.value.orderState==f[4].id},(p.value.orderState,f[4].id,{}),{t:e.t(p.value.totalMoney.toFixed(2)),v:e.t(p.value.postFee.toFixed(2)),w:e.t(p.value.payMoney.toFixed(2)),x:e.t(a.id),y:e.o((t=>{return r=a.id,void e.index.setClipboardData({data:r});var r})),z:e.t(p.value.createTime),A:e.sr(l,"34188534-1",{k:"guessRef"}),B:(null==(C=e.unref(d))?void 0:C.bottom)+"px",C:p.value.orderState==f[1].id},p.value.orderState==f[1].id?{D:e.o(g),E:e.o((e=>{var t,r;return null==(r=null==(t=n.value)?void 0:t.open)?void 0:r.call(t)}))}:e.e({F:`/pagesOrder/create/create?orderId=${a.id}`,G:p.value.orderState==f[3].id},p.value.orderState==f[3].id?{H:e.o(y)}:{},{I:p.value.orderState==f[4].id},(p.value.orderState,f[4].id,{}),{J:p.value.orderState>=f[4].id},p.value.orderState>=f[4].id?{K:e.o(I)}:{}),{L:(null==(j=e.unref(d))?void 0:j.bottom)+"px"}):{},{M:e.o(((...t)=>e.unref(i)&&e.unref(i)(...t))),N:e.f(s.value,((t,r,o)=>({a:e.t(t),b:t===u.value?1:"",c:t,d:e.o((e=>u.value=t),t)}))),O:e.o((e=>{var t,r;return null==(r=null==(t=n.value)?void 0:t.close)?void 0:r.call(t)})),P:e.o((t=>(async()=>{await r.getMemberOrderCancelByIdAPI(a.id,{cancelReason:u.value}),e.index.redirectTo({url:"/pagesOrder/list/list"})})())),Q:e.sr(n,"34188534-3",{k:"popup"}),R:e.p({type:"bottom","background-color":"#fff"})})}}};wx.createPage(o);
