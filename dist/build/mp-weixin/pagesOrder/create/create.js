"use strict";const e=require("../../common/vendor.js"),d=require("../../services/order.js"),r=require("../../stores/modules/address.js");require("../../utils/http.js"),require("../../stores/index.js"),require("../../stores/modules/member.js");const t={__name:"create",props:{skuId:{type:String,default:""},count:{type:String,default:""},addressId:{type:String,default:""},orderId:{type:String}},setup(t){const s=t,u=e.ref([]),{safeAreaInsets:o}=e.index.getSystemInfoSync(),l=e.ref(""),a=e.ref([{type:1,text:"时间不限 (周一至周日)"},{type:2,text:"工作日送 (周一至周五)"},{type:3,text:"周末配送 (周六至周日)"}]),n=e.ref(0),i=e.computed((()=>a.value[n.value])),c=e=>{n.value=e.detail.value};console.log(s.orderId);e.onShow((()=>(async()=>{if(console.log(s.orderId),s.skuId&&s.count){const e=await d.getMemberOrderPreNowAPI({count:s.count,skuId:s.skuId,addressId:s.addressId});u.value=e.result}else if(s.orderId){const e=await d.getMemberOrderPreAgainAPI(s.orderId);u.value=e.result}else{const e=await d.getMemberOrderPreAPI();u.value=e.result}})())),e.onLoad((()=>{v.selectedAddress=void 0}));const v=r.useAddressStore(),p=e.computed((()=>{var e,d,r,t,s,o,l;return 1===(null==(d=null==(e=u.value)?void 0:e.userAddresses)?void 0:d.length)?(null==(r=v.selectedAddress)?void 0:r.id)?v.selectedAddress:null==(t=u.value)?void 0:t.userAddresses[0]:(null==(s=v.selectedAddress)?void 0:s.id)?v.selectedAddress:null==(l=null==(o=u.value)?void 0:o.userAddresses)?void 0:l.find((e=>e.isDefault))})),f=async()=>{if(!p.value.id)return e.index.showToast({icon:"none",title:"请选择收货地址"});const r=await d.postMemberOrderAPI({addressId:p.value.id,buyerMessage:l.value,deliveryTimeType:i.value.type,goods:u.value.goods.map((e=>({count:e.count,skuId:e.skuId}))),payChannel:2,payType:1});e.index.redirectTo({url:`/pagesOrder/detail/detail?id=${r.result.id}`})};return(d,r)=>{var t,s,n,v,m,g,y;return e.e({a:e.unref(p)},e.unref(p)?{b:e.t(e.unref(p).receiver),c:e.t(e.unref(p).contact),d:e.t(e.unref(p).fullLocation+" "+e.unref(p).address)}:{},{e:e.f(u.value.goods,((d,r,t)=>({a:d.picture,b:e.t(d.name),c:e.t(d.attrsText),d:e.t(d.payPrice),e:e.t(d.price),f:e.t(d.count),g:d.id,h:`/pages/goods/goods?id=${d.id}`}))),f:e.t(e.unref(i).text),g:a.value,h:e.o(c),i:l.value,j:e.o((e=>l.value=e.detail.value)),k:e.t(null==(s=null==(t=u.value)?void 0:t.summary)?void 0:s.totalPrice.toFixed(2)),l:e.t(null==(v=null==(n=u.value)?void 0:n.summary)?void 0:v.postFee.toFixed(2)),m:e.t(null==(m=u.value.summary)?void 0:m.totalPayPrice.toFixed(2)),n:(null==(g=d.selecteAddress)?void 0:g.id)?1:"",o:e.o(f),p:(null==(y=e.unref(o))?void 0:y.bottom)+"px"})}}};wx.createPage(t);
