"use strict";const e=require("../../../common/vendor.js");require("../../../stores/index.js");const t=require("../../../composables/index.js"),o=require("../../../services/cart.js"),s=require("../../../stores/modules/member.js");if(require("../../../utils/http.js"),!Array){(e.resolveComponent("vk-data-input-number-box")+e.resolveComponent("uni-swipe-action-item")+e.resolveComponent("uni-swipe-action")+e.resolveComponent("XtxGuess"))()}Math||((()=>"../../../components/vk-data-input-number-box/vk-data-input-number-box.js")+(()=>"../../../node-modules/@dcloudio/uni-ui/lib/uni-swipe-action-item/uni-swipe-action-item.js")+(()=>"../../../node-modules/@dcloudio/uni-ui/lib/uni-swipe-action/uni-swipe-action.js")+(()=>"../../../components/XtxGuess.js"))();const n={__name:"CartMain",setup(n){const{guessRef:u,onScrolltolower:r}=t.useGuessList(),i=s.useMemberStore(),c=e.ref([]),a=async()=>{const e=await o.getMemberCartAPI();c.value=e.result};e.onShow((()=>{i.profile&&a()}));const d=async e=>{await o.putMemberCartBySkuIdAPI(e.index,{count:e.value})},l=e.computed((()=>c.value.length&&c.value.every((e=>e.selected)))),m=()=>{console.log(l.value);const e=!l.value;c.value.forEach((t=>{t.selected=e})),o.putMemberCartSelectedAPI({selected:e})},p=e.computed((()=>c.value.filter((e=>e.selected)))),b=e.computed((()=>p.value.reduce(((e,t)=>e+t.count),0))),v=e.computed((()=>p.value.reduce(((e,t)=>e+t.count*t.nowPrice),0).toFixed(2))),f=()=>{0===b.value?e.index.showToast({icon:"none",title:"请选择商品"}):e.index.navigateTo({url:"/pagesOrder/create/create"})};return(t,s)=>e.e({a:e.unref(i).profile},e.unref(i).profile?e.e({b:e.f(c.value,((t,s,n)=>({a:t.selected?1:"",b:e.o((e=>(e=>{e.selected=!e.selected,o.putMemberCartBySkuIdAPI(e.skuId,{selected:e.selected})})(t)),t.skuId),c:t.picture,d:e.t(t.name),e:e.t(t.attrsText),f:e.t(t.nowPrice),g:`/pages/goods/goods?id=${t.id}`,h:e.o(d,t.skuId),i:"b1c5b32c-2-"+n+",b1c5b32c-1-"+n,j:e.o((e=>t.count=e),t.skuId),k:e.p({min:1,max:t.stock,index:t.skuId,modelValue:t.count}),l:e.o((s=>{return n=t.skuId,void e.index.showModal({content:"是否删除",success:async t=>{t.confirm&&(await o.deleteMemberCartAPI({ids:[n]}),e.index.showToast({title:"删除成功"}),setTimeout((()=>{a()}),500))}});var n}),t.skuId),m:t.skuId,n:"b1c5b32c-1-"+n+",b1c5b32c-0"})))},{c:e.unref(l)?1:"",d:e.o(m),e:e.t(e.unref(v)),f:e.t(e.unref(b)),g:e.o(f),h:0===e.unref(b)?1:""}):{},{i:e.sr(u,"b1c5b32c-3",{k:"guessRef"}),j:e.o(((...t)=>e.unref(r)&&e.unref(r)(...t)))})}};wx.createComponent(n);
