"use strict";const e=require("../common/vendor.js");require("../stores/index.js");const t=require("../stores/modules/member.js"),s={invoke(e){var s;e.url.startsWith("http")||(e.url="https://pcapi-xiaotuxian-front-devtest.itheima.net"+e.url),e.timeout=1e5,e.header={"source-client":"miniapp",...e.header};const o=null==(s=t.useMemberStore().profile)?void 0:s.token;o&&(e.header.Authorization=o)}};e.index.addInterceptor("request",s),e.index.addInterceptor("uploadFile",s);exports.httpInstance=s=>new Promise(((o,i)=>{e.index.request({...s,success(s){if(s.statusCode>=200&&s.statusCode<300)o(s.data);else if(401===s.statusCode){t.useMemberStore().clearProfile(),e.index.navigateTo({url:"/pages/login/login"}),i(s)}else e.index.showToast({icon:"none",title:s.data.msg||"请求错误"}),i(s)},fail(t){e.index.showToast({icon:"none",title:"网络错误，换个网络试试"}),i(t)}})}));
